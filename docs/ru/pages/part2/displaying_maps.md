# Отображение цифровых карт

## Отображение объектов – общие сведения

Объекты карты отображаются в окне Редактора программы в соответствии с их расположением на карте. Порядок отображения объекта определяют следующие факторы:
+ характер локализации;
+ условный знак или параметры отображения, назначенные конкретному объекту на карте;
+ опции отображения карты (устанавливаются пользователем);
+ последовательность вывода слоёв карты и объектов на экран (определяется программой и пользователем);
+ механизм скрытия слоёв (управляется пользователем);
+ пороги отображения (задаются пользователем).

Работа с объектами карты осуществляется с помощью инструментов, расположенных на многостраничном поле панели инструментов в главном окне программы.

### Класс объекта

Под классом объекта в данном документе понимается совокупность классификационного кода и характера локализации объекта. Все объекты данного класса имеют, как правило, одинаковый условный знак, за исключением тех объектов одного класса, у которых условное графическое отображение зависит от их семантического описания. В каждом классификаторе может присутствовать только один объект определённого класса.

### Условный знак

Условный знак – это набор и конкретные значения признаков, определяющих изображение объектов одного вида на экране монитора. Набор признаков определяется характером локализации объекта и семантическим описанием объекта, а способ визуализации данного набора устанавливается в классификаторе.

Программа позволяет назначить конкретному объекту на карте параметры изображения, отличающиеся от условного знака объектов этого вида, с помощью инструмента «Изменить графику объекта» ![alt-текст](../_assets/tool_color.png) из вкладки «Объект» на панели инструментов.

### Настройка отображения названия объекта

Опции «Акроним» и «Название» в списке главного меню «Настройка»–«Название объекта» определяют, что будет отображаться в строке подсказки Редактора при активации объекта в карте и в верхней строке Легенды карты при выборе объекта в списке Легенды. Данные опции задействуются в классификаторах, где в качестве разделителя в названии объектов используется символ «/», который является разделителем позиций текста для данной опции, а также в новых классификаторах, где используются акронимы объектов. Пример работы опций представлен на рисунке:

![alt-текст](_assets/setting_acronym.png "Настройка отображения информации об объекте в строке подсказки и легенде карты")
 
## Порог (уровень) отображения

Поскольку цифровая карта может отображаться в различных масштабах, то порог отображения определяет нижнее (самое большое) значение масштаба, с которого начинает отображаться на экране определённый объект, слой или карта целиком. Наличие порогов позволяет управлять нагрузкой карты при разных увеличениях и избегать перенасыщенности изображения мелкими или избыточными деталями (генерализация). Порог может быть назначен для всей карты, входящей в проект, для определённого слоя или для конкретного объекта карты. Далее под объектами понимаются карты, слои и объекты карты.

Пороги измеряются в единицах отношения размеров текущей карты к размерам участка карты, который отобразили бы в окне, развернутом во весь экран, при данном увеличении.

Нулевое значение порога означает, что объект отображается всегда.

Если включена опция «Все объекты» в опциях отображения, то пороги отображения игнорируются и все объекты отображаются при любых масштабах.

Управление порогами отображения карт описано ниже.

## Окно отображения карты (Редактор)

Окно «Редактор» служит для отображения карты с возможностью изменения масштаба изображения объектов карты и навигации (передвижения) по карте. В данном окне осуществляются непосредственные действия по созданию, выбору и редактированию объектов.

Окно имеет следующий вид:

![alt-текст](_assets/win_editor.png "Окно «Редактор»")

На верхней рамке окна «Редактор» отображается информация о названии активной карты проекта и служебная метка карты.

Обозначения служебных меток карты:
+ (x) – в карте нельзя создать объекты в цепочно-узловой структуре, т.е. возможны только объекты типа «картографическое спагетти»;
+ (o) – в карте могут присутствовать объекты в цепочно-узловой структуре;
+ (w) – в карте возможна работа с номерами характеристик больше 1024 (в версиях ПК «Нева» до 2014 года работа с большими характеристиками возможна только при запуске программы с ключом «/hf16»).

На нижней рамке окна «Редактор» находится набор инструментов, предназначенных для увеличения, уменьшения и перемещения изображения внутри окна, измерения расстояния, а также строка отображения координат, позволяющая отображать информацию в нескольких режимах.

## Координатная строка

Поле «Координаты» служит для отображения координат текущей позиции курсора в окне Редактора карт. При запуске программы данное поле всегда находится в режиме показа координат, но в дополнение к указанной функции его возможно переключить на следующие режимы работ:
+ Режим «Координаты»
+ Режим «Масштаб»
+ Режим «Линейка»

Переключение режима производится в диалоге, который вызывается нажатием правой кнопки мыши на координатной строке:

![alt-текст](_assets/coord_line_change_mode.png "Контекстное меню режима работы координатной строки окна Редактора")

### Режим «Координаты»

По умолчанию координаты отображаются в местных координатах проекта в метрах:

![alt-текст](_assets/coord_line.png "Координаты курсора в координатной строке окна редактора")

Для переключения режима показа координат необходимо кликнуть правой кнопкой мыши в строку «Координаты» и выбрать в появившемся диалоге требуемый вариант отображения:

![alt-текст](_assets/coord_line_mode.png "Контекстное меню выбора режима показа координат в координатной строке")

Режим «Расстояние, азимут» устанавливается и работает при создании или редактировании отрезков контура (в режиме активной функции «Создать простой объект» ![alt-текст](../_assets/but_mode_new.png) в панели инструментов).

### Режим «Масштаб»

Координатная строка в режиме отображения масштаба выглядит следующим образом:

![alt-текст](_assets/mode_scale.png "Отображение в координатной строке текущего масштаба карты")

Нажав кнопку ![alt-текст](_assets/mode_scale_but_list.png) в строке «Масштаб», можно выбрать вариант фиксированного масштаба из списка:

![alt-текст](_assets/mode_scale_menu.png "Меню выбора масштаба отображения карты")

Кнопками ![alt-текст](_assets/mode_scale_but_left.png) и ![alt-текст](_assets/mode_scale_but_right.png) можно переключать масштабы вверх и вниз по списку, не вызывая самого списка.

Внизу списка масштабов находится команда «Интернет уровень…», открывающая диалог выбора уровня отображения в соответствии с принятыми для WEB-среды масштабами:

![alt-текст](_assets/web_scale.png "Диалог команды «Интернет уровень» из меню выбора масштаба отображения карты")

Ниже команды «Интернет уровень…» есть возможность задания проекции, применяемой для отображения данных с интернет-ресурса:
+ mercator
+ geodetic
+ google

### Режим «Линейка»

В режиме «Линейка» на координатной строке отображается сантиметровая шкала с делениями, где справа от шкалы показывается длина одного деления в метрах, исходя из масштаба карты, установленного в паспорте карты:

![alt-текст](_assets/mode_ruler.png "Отображение в координатной строке масштабной линейки")

## Увеличение масштаба

После нажатия на кнопку ![alt-текст](_assets/but_zoom_in.png) происходит переход в режим задания прямоугольного фрагмента, который следует увеличить до размеров всего окна. При этом курсор мыши в окне отображения изображается крестиком с прямоугольником ![alt-текст](_assets/cur_zoom.png). Задание прямоугольника окна может происходить двумя способами:

+ интерфейс в стиле «Windows»;
+ интерфейс в стиле «DOS» (установлен по умолчанию).

Стиль определяется в опциях отображения (команда «Настройка»–«Опции…», флажок «\<dos\> интерфейс»).

При использовании первого способа для указания прямоугольника необходимо нажать левую кнопку мыши и, не отпуская её, перетаскивать курсор. При этом происходит растягивание прямоугольника. После достижения необходимого размера следует отпустить кнопку для фиксации прямоугольника.

При использовании второго способа для указания прямоугольника необходимо щёлкнуть левой кнопкой мыши в месте расположения первого угла, а затем передвигать курсор при отпущенной кнопке. При этом происходит растягивание прямоугольника. После достижения необходимого размера следует щёлкнуть либо левой кнопкой мыши для фиксации прямоугольника, либо правой – для отмены операции.

После фиксации фрагмента, программа увеличивает указанный фрагмент до размеров окна.

## Уменьшение масштаба и работа с инструментом «Линейка»

Нажатие кнопки ![alt-текст](_assets/but_zoom_out.png) вызывает меню со следующими командами:

![alt-текст](_assets/small_zoom_but_menu.png "Меню кнопки уменьшения масштаба")

Команда «Интернет уровень…» появляется при подключении к сети интернет, если указана папка для КЭШа интернет ресурса (команда функционального меню «Растр»–«Интернет»–«Кэш…») и используется для переключения уровня подгружаемого в качестве растровой подложки интернет ресурса. Аналог указания уровня подложки интернет ресурса в диалоге окна «Проект»:

![alt-текст](_assets/zoom_out_project.png "Уровень подложки интернет ресурса в диалоге окна «Проект»")

### Линейка – многофункциональное инструментально окно

Окно многофункционального инструмента «Линейка» предназначено для расчёта расстояний и углов по карте, а также ряда других операций:

![alt-текст](_assets/win_ruler.png "Окно инструмента «Линейка»")

Вызов окна «Линейка» можно осуществлять с помощью горячей клавиши F4, а также внизу окна «Редактор» через кнопку уменьшения масштаба ![alt-текст](_assets/but_zoom_out.png):

![alt-текст](_assets/win_ruler_open.png "Вызов инструмента «Линейка» через кнопку уменьшения масштаба")

Функции инструмента «Линейка»:
+ отображение координат и высоты каждой точки карты
+ определения азимута направления от одной точки до другой
+ определение расстояния между точками, а также протяжённость пути указанного последовательностью точек на карте
+ вычисление относительной высоты объектов
+ вычисление объёма объектов
+ отображение положения позиции точки профиля
+ отображение высоты в виде всплывающей подсказки рядом с курсором, при перемещении курсора в окне редактора карты с открытым в проекте файлом матрицы рельефа

Инструмент «Линейка» может быть задействован в нескольких режимах:
+ [Режим «Линейка»](#anchor1)
+ [Режим «Высота»](#anchor2)
+ [Режим «Объём»](#anchor3)
+ [Режим «Метрика – 2 точки»](#anchor4)
+ [Режим «Подсказка высоты»](#anchor5)
+ [Режим «Линейка на карте»](#anchor6)
+ [Режим «Координаты сетки»](#anchor7)

При вызове инструмента «Линейка» курсор в окне Редактора принимает форму перекрестия ![alt-текст](_assets/cur_ruler.png). Смена режимов работы инструмента «Линейка» производится по клику правой кнопки мыши в окне инструмента, после чего в выпадающем списке выбирается нужный режим работы.

![alt-текст](_assets/win_ruler_change_mode.png "Выбор режима работы инструмента «Линейка»")

#### Окно «Линейка» – режим «Линейка» {#anchor1}

Данный режим работы задействован по умолчанию при первом вызове инструмента и позволяет получить координатную информацию об указанной точке и о рисуемой линии. Для получения информации о линии следует рисовать линию так же, как при создании нового объекта. При этом в окне отображается следующая информация:

![alt-текст](_assets/tool_ruler_about.png "Значения полей инструмента «Линейка» в режиме «Линейка»")

+ Левое поле «Расстояние» – общая протяжённость метрики, включая текущую позицию курсора
+ Правое поле «Расстояние» – расстояние от последней поставленной точки до позиции курсора
+ Поле «Азимут/Угол» – азимут либо угол указанного направления, в зависимости от выбранного параметра
+ Поле «Координаты» – координаты текущей позиции курсора «Широта, Долгота», если карта в географической системе координат, либо X, Y если карта в прямоугольной системе координат

Поле «Высота» – значение высоты отображается только при загруженном в проект файле рельефа на данную местность.

При работе с картами в равноугольных проекциях для измерения расстояния предусмотрена возможность выбора режима измерения:
+ на эллипсоиде (по умолчанию, т.к. данный режим даёт минимальные погрешности при измерении)
+ в проекции (если требуется проводить измерения в проекции карты)

Также есть возможность выбора системы координат, если требуется производить измерения в системе координат отличной от системы координат карты (кнопка ![alt-текст](_assets/mode_scale_but_list.png) в правом нижнем углу).

#### Окно «Линейка» – режим «Высота» {#anchor2}

Данный режим работы линейки предназначен для автоматического внесения вычисляемого значения высоты объектов в заданную характеристику, путём измерения линейкой теней объектов по данным ДЗЗ. Применяется обычно при оцифровке зданий и сооружений, где требуется наличие значений относительной высоты у объектов для построения реалистичных 3D моделей местности.

Перед использованием функции автоматического внесения значения высоты в атрибуты объектов необходимо в опциях программы задать номер характеристики, в которую программа будет писать полученное значение. Для этого необходимо из функционального меню главного окна программы вызвать диалог опций командой «Настройка»–«Опции…» или горячей клавишей F8, где в разделе «Разное», в поле «Атрибут <высота по линейке>» указать номер характеристики для значения высоты, как показано на рисунке:

![alt-текст](_assets/options_atr_h.png "Установка атрибута высоты для работы с инструментом «Линейка» в режиме «Высота»")

После указания атрибута высоты в опциях следует подобрать коэффициент вычисления значения высоты с учётом времени снимка, т.к. тени от объектов в разное время суток имеют, соответственно, разную длину. Последовательность действий для подбора коэффициента высоты следующая:
+ Открыть карту совместно с растровым изображением данных ДЗЗ;
+ С помощью горячей клавиши F4 вызвать инструмент «Линейка» и, кликнув правой кнопкой мыши в появившемся окне линейки, переключить его левой кнопкой в выпадающем списке на режим «Высота», при этом окно примет следующий вид:

![alt-текст](_assets/win_ruler_tool_h.png "Подбор коэффициента для измерения атрибута высоты инструментом «Линейка» в режиме «Высота»")

+ Измеряя тени «эталонных» объектов (высота которых известна), подобрать коэффициент высоты так, чтобы при измерении длины тени объекта полученное значение высоты было наиболее близкое к реальности. При отсутствии точных сведений о высоте «эталонных» объектов, по которым подбирается коэффициент, данные действия выполняются по характерным объектам с чётко дешифрируемым контуром и тенью, приблизительная высота которых известна. В качестве таких характерных объектов могут быть использованы навесы автозаправок, у которых, как правило, высота козырька около 5 метров.

Действия для автоматической записи вычисленного значения высоты в атрибут существующего объекта:
+ Убедиться, что в инструменте «Линейка» выбран и настроен режим «Высота».
+ В режиме выбора объекта, когда на панели инструментов нажата кнопка ![alt-текст](../_assets/but_mode_activ.png), активировать нужный объект карты.
+ Кликом левой кнопки мыши указать начальную точку тени объекта, затем конечную точку тени объекта. После указания второй точки программа запишет вычисленное значение высоты в заданную характеристику выбранного объекта. При этом у площадных объектов будет меняться цвет контура на синий.
+ Повторить аналогичные действия со следующим объектом.

Действия для автоматической записи вычисленного значения высоты в атрибут создаваемого объекта:
+ Убедиться, что в инструменте «Линейка» выбран и настроен режим «Высота».
+ В режиме создания нового объекта ![alt-текст](../_assets/but_mode_new.png) после обозначения окончания оцифровки объекта правой кнопкой мыши, нажать горячую клавишу F4, при этом на панели инструментов автоматически активируется режим выбора объектов ![alt-текст](../_assets/but_mode_activ.png), затем кликом левой кнопкой мыши указать начальную точку тени объекта, затем конечную точку тени объекта. После указания второй точки программа запишет созданный объект уже со значением высоты в заданной характеристике и автоматически произойдёт переход в режим создания нового объекта ![alt-текст](../_assets/but_mode_new.png), для оцифровки следующего. Цвет контуров площадных объектов созданных таким образом, также будет меняться на синий.

#### Окно «Линейка» – режим «Объём» {#anchor3}

Режим «Объём» работает при наличии в проекте файла рельефа и позволяет измерять объём объектов с учётом матрицы высот.

При переходе в режим необходимо точками обозначить область полигона для расчёта объёма. Рядом с курсором, во время его перемещения по карте, отображается высота данной точки местности, так же как и в режиме «Подсказка высоты», только подсказка высвечивается в левом верхнем углу курсора. В окне «Линейка», при перемещении курсора по карте, в нижней строке отображаются координаты позиции курсора и высота точки местности под курсором.

По окончании оцифровки полигона, на карте появляется контур розового цвета и в верхней строке окна «Линейка» выводится результат:

![alt-текст](_assets/tool_ruler_mode_volume.png "Измерение объёма объекта инструментом «Линейка»")

Контур расчётной области не является объектом карты и убирается после перезапуска программы.

#### Окно «Линейка» – режим «Метрика – 2 точки» {#anchor4}

Режим предназначен для работы с профилем рельефа. В данном режиме двумя точками в окне «Редактор» указывается вектор сечения профиля рельефа, который будет отображаться в виде стрелки, как представлено на рисунке:

![alt-текст](_assets/tool_ruler_mode_profile.png "Указание вектора сечения профиля рельефа инструментом «Линейка»")

Если в проект загружен файл рельефа местности, то при указании в окне «Профиль» места сечения рельефа (вертикальная линия синего цвета на рисунке ниже), на стрелке маркируются координаты этого места розовым крестиком. Окно «Профиль» вызывается командой функционального меню «Окна»–«Профиль» или горячими клавишами Shift+Z.

![alt-текст](_assets/relief_profile.png "Окно профиля рельефа")

#### Окно «Линейка» – режим «Подсказка высоты» {#anchor5}

Режим линейки «Подсказка высоты» работает при наличии в проекте файла рельефа. При включении данного режима рядом с курсором во время его перемещения по карте отображается высота данной точки местности:

![alt-текст](_assets/ruler_mode_height_hint.png "Подсказка высоты на карте")

#### Окно «Линейка» – режим «Линейка на карте» {#anchor5}

В режиме «Линейка на карте» в левом верхнем углу окна Редактора карты отображается миллиметровая шкала, исходя из масштаба, указанного в паспорте карты: 

![alt-текст](_assets/ruler_on_the_map.png "Отображение миллиметровой шкалы на карте")


#### Окно «Линейка» – режим «Координаты сетки» {#anchor7}

![alt-текст](_assets/ruler_grid_coord.png "Окно линейки в режиме «Координаты сетки»")

## Перемещение изображения («Передвинуть точку»)

Перемещение изображения карты возможно несколькими способами.

### 1-й способ перемещения изображения

### 2-й способ перемещения изображения

### 3-й способ перемещения изображения

### 4-й способ перемещения изображения

### 5-й способ перемещения изображения


## Перерисовка окна

## Отображение набора карт

## Управление набором векторных карт – команды меню «Проект»

## Управление набором пространственных данных – окно «Проект»

## Навигация по карте – Окно «Обзор»

## Увеличение фрагмента карты – окно «Лупа»

## Закладки для изображений

## Настройки параметров отображения

## Контекстное меню работы с активным объектом

## Контекстное меню в режиме создания нового объекта

## Окно выбора объекта «Легенда»

## Управление слоями карты – окно «Слои»

## Управление отображением атрибутов (виртуальные знаки и подписи)

## Управление отображением координированных атрибутов

## Настройка ассоцииации файлов карт *.dm с программой dmw.exe

## Окно «Просмотр…»
