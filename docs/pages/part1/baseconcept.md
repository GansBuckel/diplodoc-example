# Основные понятия

## Цифровая карта

Под ЦИФРОВОЙ КАРТОЙ (далее – картой) в данном документе понимаются цифровые данные в векторном формате о пространственных объектах участка местности, расположенных в границах карты. Вся информация цифровой карты содержится в файле внутреннего формата с расширением &#42;.DM.

## Типы цифровых карт

ПК «ГИС Нева» поддерживает работу с двумя типами цифровых карт:
1. **Карта** – набор объектов, привязанный к географическим координатам земной поверхности с использованием устанавливаемых при создании карты геодезической системы координат и картографической проекции.
**Номенклатурный лист** – разновидность типа «Карта» для определённых стандартных видов разграфки карт, когда система координат, проекция и рамка карты автоматически определяются по имени номенклатурного листа разграфки.
1. **План** – набор объектов в произвольной прямоугольной системе координат без привязки к географическим координатам земной поверхности, т.е. для плана не устанавливается система координат и проекция.

## Структурная модель карты

Вся информация карты организована в виде набора однотипных структурных элементов, связанных в единое иерархическое дерево.
Каждый структурный элемент карты (объект) может содержать следующую информацию:
+ класс объекта;
+ тип объекта;
+ координатное описание;
+ атрибутивное описание.

Обязательным является наличие описания класса объекта (классификационный код) и его типа. Координатное и атрибутивное описания необязательны.

### Иерархическое дерево карты {#anchor1}

<p align="center">
<img src="_images/hierarchical_tree.png">
</p>
<p align="center">
Иерархическое дерево цифровой карты
</p>

На рисунке представлено иерархическое дерево цифровой карты, которое состоит из веток и организуется путём установления связей между структурными элементами – объектами. Связь представляет собой ссылку от одного объекта на другой. Ссылками связаны соседние объекты в одном уровне иерархии (в одной ветке). Это горизонтальные связи: «сосед слева» и «сосед справа».

Ссылкой «вниз» на нижний уровень от любого объекта на другой объект образуется его подчинённая ветка. Этот объект является «родительским» для всех объектов его ветки, объекты подчинённой ему ветки – «дочерние» объекты для «родительского». Дочерние объекты расположены на уровень ниже родительского.
 
Таким образом, каждый объект иерархического дерева, кроме корневого объекта, может содержать следующие ссылки (связи):
+ сосед слева;
+ сосед справа;
+ первый дочерний (подчинённый) объект (ссылка вниз);
+ родительский объект (ссылка наверх).

Для корневого объекта допустима только одна ссылка вниз – первый дочерний (подчиненный) объект.
Для просмотра объектов карты с возможностью перемещения по иерархическому дереву используется диалоговое окно «Инспектор», представленное на рисунке ниже.

<p align="center">
<img src="_images/inspector.png">
</p>
<p align="center">
Диалоговое окно «Инспектор»
</p>

Открыть данное диалоговое окно можно командой функционального меню «Окна»»–««Инспектор» или горячей клавишей F5.

В инспекторе отображается вся информация по текущему объекту, а расположенные сверху кнопки стрелок (влево, вправо, вверх, вниз) позволяют перемещаться на другие объекты в дереве по соответствующей стрелке.

### Корневой объект и паспорт карты

В вершине иерархического дерева карты (см. рисунок [Иерархическое дерево цифровой карты](#anchor1) – уровень 0) расположен корневой объект карты, содержащий общее описание карты:
+ классификационный код корневого объекта – 00000000;
+ тип объекта – линия;
+ координатное описание – координаты точек границы (рамки) карты;
+ атрибутивное описание или Паспорт карты (метаданные) – набор характеристик, описывающих карту в целом (классификатор, проекция, система координат, масштаб, номенклатура и т.п.).

### Слои карты

Корневой объект карты ссылается вниз по дереву на первый структурный элемент уровня 1. На уровне 1 располагаются в упорядоченной последовательности специальные объекты, определяющие слои карты.

#### Общее описание слоя

Слои карты обеспечивают разделение на группы (слои) всех объектов цифровой карты, т.е. каждый объект цифровой карты обязательно принадлежит одному из слоёв. 
Описание специального объекта «Слой карты»:
+ классификационный код – описывается в Классификаторе;
+ тип объекта – «Меню»;
+ координатное описание – отсутствует;
+ атрибутивное описание – отсутствует.

Количество слоёв в карте неограниченно. Слой может не содержать объектов карты, т.е. быть пустым.

#### Создание слоёв и управление слоями карты

При создании новой карты программа всегда формирует один слой с кодом 00000000, в котором располагаются специальные объекты – угловые точки карты. При объединении информации карт (внешняя карта «вставляется» в текущую) их слои суммируются, т.е. если есть слои с совпадающими кодами, то объекты внешней карты размещаются в таком же слое текущей карты, а если в текущей карте нет слоя внешней карты, то он добавляется в текущую карту.
Для слоя могут быть выполнены операции: 
+ вкл/выкл видимость всех объектов слоя;
+ удалить слой со всеми объектами слоя;
+ запретить редактирование всех объектов слоя;
+ собрать статистическую информацию по объектам слоя;
+ переместить слой относительно других слоёв.

Для выполнения операций над слоями предназначено диалоговое окно «Слои», которое открывается командой функционального меню «Окна»»–««Слои» или горячей клавишей F7.

<p align="center">
<img src="_images/layers.png">
</p>
<p align="center">
Диалоговое окно «Слои»
</p>

В данном диалоговом окне отображаются пиктограммы слоев, которые размещены слева направо от первого слоя до последнего. Отображение объектов карты на экран выполняется в этой последовательности, т.е. изображение всех объектов следующего слоя накладывается на изображение объектов предыдущих слоев. Положение любого слоя в последовательности может быть интерактивно изменено.

В этом окне можно добавить, удалить, переместить слои, присвоить им код, собрать по ним информацию, назначить масштабы видимости слоя. Новые слои создаются на основе объектов типа «меню» из классификатора, т.е. для создания слоя необходимо открыть диалоговое окно «Легенда» (F6), в нём выбрать объект типа «Меню» и нажать кнопку «Добавить слой» <img src="_images/layer_add.png" height="24px">.

При добавлении слоя ему будут назначены код, имя и пиктограмма, соответствующие этому объекту. Если окно Легенды не открыто или в нём не выбран объект типа «Меню», программа не сможет создать новый слой. При удалении слоя автоматически удаляются все объекты, принадлежащие этому слою, при этом программа выдаёт предупреждение и сообщает количество удаляемых объектов в слое.

### Объекты карты

Объект-слой ссылается вниз по иерархическому дереву на свой первый дочерний объект уровня 2 – это объект цифровой карты, расположенный в этом слое. На уровне 2 в каждом слое располагаются упорядоченно объекты карты данного слоя.

При создании объекта в карте он автоматически размещается в слой, назначенный ему в Классификаторе указанием в специальном поле маски слоя. Маска слоя состоит из двух первых символов классификационного кода объекта-слоя, в который необходимо поместить объект данного класса.

На рисунке изображен фрагмент Классификатора, где объекту с кодом 30111100 назначен слой размещения, классификационный код которого в первых двух позициях содержит значение «30».

<p align="center">
<img src="_images/layer_mask.png">
</p>
<p align="center">
Маска слоя карты в классификаторе для автоматического размещения объекта в карте
</p>

При добавлении объекта в карту он заносится в слой, две старших цифры которого совпадают с установленным для объекта признаком в классификаторе (Маска слоя).

Если для добавляемого объекта в карте отсутствует соответствующий слой, то он добавляется в первый слой карты.

Каждый объект карты уровня 2 может «под собой» иметь дочерние объекты на уровне 3. Объекты уровня 3 – родительские для объектов уровня 4 и так далее (см. рисунок [Иерархическое дерево цифровой карты](#anchor1)).

Для ручного перемещения объекта между уровнями иерархического дерева внутри слоя используется специальная функция редактора.

Для выделенного в карте объекта можно увидеть значение уровня, на котором он расположен, с помощью нажатия на клавишу «V». Если объект расположен на уровне ниже второго (значение уровня больше 2), то значение уровня отобразится в информационной строке меню головного модуля – в скобках перед классификационном кодом объекта, как представлено на рисунке:

<p align="center">
<img src="_images/layer_info.png">
</p>
<p align="center">
Отображение в информационной строке информации о выделенном объекте
</p>

В данном примере на карте выделен полигональный объект «Озеро» с кодом 30111100, находящийся на уровне 3.

Иерархическая модель хранения информации цифровой карты в виде «родительских» и «дочерних» объектов предполагает следующее правило удаления объектов – при удалении объекта автоматически удаляются все его дочерние объекты со своими дочерними объектами. Т.е. если удалить объект-слой, то из карты будут удалены все объекты этого слоя. На представленном рисунке зачеркнуты объекты, которые будут удалены из карты в случае удаления объекта-слоя с номером 3.

<p align="center">
<img src="_images/layer_del.png">
</p>
<p align="center">
Удаление объекта-слоя из цифровой карты
</p>

## Объект цифровой карты {#anchor2}

Основной структурной и информационной единицей цифровой карты является объект. Информационная модель объекта в виде UML-диаграммы классов представлена рисунке:

<p align="center">
<img src="_images/UML_struktura_objekta.png">
</p>
<p align="center">
Информационная модель объекта цифровой карты
</p>

Информационная модель содержит описание класса объекта, его типов, пространственного положения и атрибутивного описания.

Правила чтения UML-диаграмм описаны [здесь](#anchor)

### Виды объектов

ПК ГИС «Нева» поддерживает обработку пяти видов объектов:
1. Пространственный объект (геообъект)
1. Объект «Меню»
1. Объект – «Координированный атрибут (Атрибут)»
1. Информационный объект (Информация)
1. Объект – «Подпись»

На [UML-диаграмме](#anchor2) все виды объектов наследуют от абстрактного класса «Описание класса объекта» общее классификационное описание, состоящее из трех атрибутов:
+ классификационный код – обязателен;
+ наименование класса – не обязательно;
+ акроним класса – не обязательно.

Класс объекта обязательно описывается уникальным, в пределах Классификатора, значением классификационного кода – восьмисимвольная строка, первым символом которой может быть символ цифры или буквы латинского алфавита, а на позициях со 2 по 8 могут размещаться только символы цифр. Как правило, в целях удобства использования значения классификационных кодов формируются по иерархическому принципу от старшего левого разряда кода к правому восьмому разряду кода.

Символьный акроним – мнемоническое обозначение класса объекта с использованием латинских символов. Как правило, набор символов соответствует смысловому значению класса объекта. Количество символов в акрониме не ограничено.

Название класса объекта отображает его смысловую сущность и может быть произвольной строкой.

На рисунке представлено классификационное описание объекта древесной растительности, отображаемое в информационной строке главного меню программы:

<p align="center">
<img src="_images/infostroka.png">
</p>
<p align="center">
Классификационное описание объекта
</p>

Данное описание состоит из следующих полей:
+ 70100000 – код объекта;
+ 3 – код характера локализации (типа) объекта (описание см. [здесь](#anchor));
+ WdVeg – акроним;
+ Растительность древесная – название класса.

Вид объекта устанавливается при его создании в Редакторе Классификатора. На следующем рисунке показано меню классификационного описания объекта, в котором для объекта выбирается одно из трех значений:
+ **Объект** – для объектов вида:
    + Пространственный объект
    + Меню
    + Подпись
+ **Информация** – для информационного объекта
+ **Атрибут** – для объекта «Координированный атрибут»

<p align="center">
<img src="_images/klass_menu_object.png">
</p>
<p align="center">
Выбор вида объекта в меню классификационного описания
</p>

Уточнение выбранного вида «Объект» – пространственного, типа меню или подпись выполняется при установлении его характера локализации (тип объекта). Характер локализации объекта определяет тип его координатного описания – в виде одной точки, линии или замкнутого контура, огибающего область. Характер локализации устанавливается в меню классификационного описания объекта путём выбора одного из четырёх значений.

<p align="center">
<img src="_images/klass_menu_object2.png">
</p>
<p align="center">
Выбор характера локализации для объекта «Пункт опорный»
</p>

В меню классификационного описания ниже строки выбора вида объекта расположены четыре пиктограммы, нажатием на которые устанавливается характер локализации:

<img src="_images/but_sign.png" height="22px"> — знак
<img src="_images/but_line.png" height="22px"> — линия
<img src="_images/but_area.png" height="22px"> — область
<img src="_images/but_text.png" height="22px"> — выбор типа объекта «Подпись» или «Текст»

Характеры локализации знак, линия и область могут быть выбраны для пространственного объекта или координированного атрибута, причём одновременно может быть выбрано несколько значений, т.е. объект данного класса может быть создан с любым типом координатного описания.

#### Пространственный объект (геообъект)

Пространственный объект или ГеоОбъект обязательно имеет описание своего пространственного положения и может иметь описание свойств в виде неограниченного набора атрибутов различного типа.
Пространственное положение объекта (см. dataType «SpatialLocation» на [UML-диаграмме](#anchor2)) может быть описано двумя способами:
+ с помощью координатного описания одного из видов локализации;
+ без координатного описания путём установления связей с другими пространственными объектами, имеющими координатное описание.

{% cut "Пространственный объект типа «Знак»" %}

Объектом типа «Знак» могут создаваться пространственные объекты, положение которых можно описать одной координированной точкой – **точечный объект**. Такие объекты отображаются с помощью условных знаков, имеющих одну точку привязки. Объект этого типа может содержать вторую координированную точку, выполняющую вспомогательную функцию – указание вектора направления наклона условного знака объекта и его размера при визуализации. В этом случае такой объект карты иногда называют **векторным объектом**.

На карте объект типа «Знак» изображается неориентированным (точечным) или ориентированным (векторным) условным знаком. Неориентированный условный знак описывается одной точкой, соответствующей точке привязки. Ориентированный (векторный) условный знак описывается двумя точками, при этом вторая точка (точка направления) используется для задания направления и размера условного знака.

Кроме того, условный знак может быть **масштабируемым**, **не масштабируемым** и **частично масштабируемым**.

Размер масштабируемого условного знака зависит от расстояния между точкой привязки и точкой направления и может быть пропорционально изменен путём перемещения этой точки.

Размер не масштабируемого условного знака является фиксированным на карте, т.е. он всегда занимает на карте место, соответствующее на местности его высоте, умноженной на паспортный масштаб карты. При перемещении точки направления изменяется только ориентация не масштабируемого знака, размер остаётся фиксированным.

У частично масштабируемого условного знака высота знака фиксирована, а ширина определяется расстоянием между точкой привязки и точкой направления.

Характер масштабируемости знака определяется при его создании в редакторе векторных знаков:
+ если в поле «высота» не указана или указано нулевое значение, знак будет масштабируемым;
+ если в поле «высота» указано положительное значение, знак будет не масштабируемым;
+ если в поле «высота» указано отрицательное значение, знак будет частично масштабируемым, и высота знака равна абсолютному значению указанной величины.

Масштабируемый и не масштабируемый знаки изменяют размеры при изменении увеличения карты в окне «Редактор».

Примеры точечных объектов: геодезические пункты, ориентиры, подводные камни и др.

{% endcut %}

{% cut "Пространственный объект типа «Линия»" %}

Объектом типа «Линия» описываются линейно-протяженные пространственные объекты, для которых координатное описание может быть сформировано вдоль объекта по его оси.

Такие объекты отображаются на карте в виде линии определённого стиля и цвета.

В зависимости от направления цифрования линейные объекты делятся на две группы:
+ с произвольным направлением цифрования;
+ с фиксированным направлением цифрования.

Цифрованию в произвольном направлении подлежат объекты, последовательность координат которых не имеет значения при дальнейшем использовании информации, связанной с данным объектом (трубопроводы, ЛЭП, и т.п.).

Фиксированное направление цифрования имеют объекты, графическое изображение которых на топографической карте связано с:
+ различием высот местности по сторонам этих объектов (горизонтали, обрывы и т.п.) – такие объекты описываются по правилу «бо́льшая высота слева»;
+ разными высотами концевых точек (например, река) – эти объекты описываются по правилу «первая точка имеет бо́льшую высоту».

Примеры линейных объектов: горизонталь, дорога, река.

{% endcut %}

{% cut "Пространственный объект типа «Область»" %}

Объект типа «Область» или площадной объект (полигон, область) – это объект, выражающийся на местности в масштабе карты по длине и ширине, т.е. может быть изображен в виде пространственной области по её границе.

Площадные объекты описываются последовательностью координат граничных точек области. Они всегда создаются и отображаются при создании замкнутыми (координаты первой и последней точки должны совпадать). Площадной объект может иметь внутренние контура – «дырки».

Примеры площадных объектов: лес, озеро, строение.

При векторизации (цифровании) может использоваться любое направление указания последовательности точек, поскольку после завершения цифрования объекта программа запишет в файл карты точки в фиксированной последовательности – внутренняя часть объекта слева.

{% endcut %}

{% cut "Пространственный объект «Без метрики»" %}

Пространственный объект данного типа не имеет собственного координатного описания и при его создании он обязательно связывается с другим пространственным объектом, имеющим координатное описание.

Для объекта «без метрики» также используется название – «Группа». Создание объектов без метрики возможно только в цифровых картах объектной модели.

Установление флага «Без метрики» для пространственного объекта выполняется в основном окне Редактора классификатора, как представлено на рисунке:

<p align="center">
<img src="_images/flag_bez_metriki.png">
</p>
<p align="center">
Установление флага «без метрики» для пространственного объекта
</p>

Флаг «без метрики» может быть установлен одновременно с установкой каких-либо характеров локализации, т.е. такой объект можно создавать как без координатного описания, так и с координатным описанием. Выбор типа создаваемого объекта производится из разрешенного в Классификатора перечня в окне «Легенда»:

<p align="center">
<img src="_images/menu_choice_new_object.png">
</p>
<p align="center">
Выбор характера локализации/типа создаваемого объекта
</p>

В данном примере в окне легенда для объекта «Административная единица» разрешены три типа его создания:

<img src="_images/but_nometric.png" height="22px"> — без метрики
<img src="_images/but_sign.png" height="22px"> — знак
<img src="_images/but_area.png" height="22px"> — область

Выбран для создания тип «без метрики».

Объекты без метрики целесообразно создавать в тех случаях, когда они полностью повторяют метрику другого объекта или, когда граница объекта не может быть чётко координирована, но указанием ссылок на другие объекты местоположение описывается однозначно. Примером объекта без метрики является класс «Архипелаг», который однозначно образуется группой островов.

{% endcut %}

#### Объект «Меню»

Объект вида «Меню» является абстрактным, т.е. объекта с таким кодом создать в карте нельзя. Он предназначен для группировки (агрегации) классов пространственных объектов в обобщающий класс. Например, все классы, описывающие объекты гидрографии, удобно объединить под обобщающим классом «Гидрография».

Такое обобщение удобно для группировки классов объектов в меню «Легенда», которое строится по иерархическому принципу, что позволяет достаточно быстро выбирать нужный класс объекта (его пиктограмму) для создания объекта в карте.

#### Объект «Координированный атрибут» {#anchor3}

Объект вида «Координированный атрибут» или «Атрибут» является специальным видом объекта, предназначенным для указания пространственного положения значения какого-либо атрибута на пространственном объекте. Использование координированного атрибута исключает необходимость деления линейно-протяженных объектов в местах изменения каких-либо свойств. Например, материал покрытия автодороги изменяется на её протяжении, и без использования координированных атрибутов объект приходится делить в местах изменения материала покрытия, что нарушает основное положение объектно-ориентированного подхода – сохранение целостности пространственного объекта независимо от изменения его свойств в пространстве и во времени. При использовании координированного атрибута «материал покрытия» он «накладывается» на координатное описание автодороги без её разделения на участки. Для площадного объекта координированный атрибут может указывать область распространения какого-либо свойства внутри объекта. Например, участок непроходимого болота внутри общего болота, или область распространения определенной породы деревьев внутри массива древесной растительности.

На традиционных топографических картах также используется приём указания пространственного положения какого-либо свойства на основном объекте в виде отдельных условных знаков или подписей: значения урезов воды вдоль водотока, подписи различных значений относительной высоты вдоль обрыва или вдоль полосы леса и т.п. Подписи значений атрибутов объектов на картах размещают с учётом мест их фактических измерений.

Объект «Атрибут» обязательно «принадлежит» пространственному объекту типа «линия» или «область», имеет собственное координатное описание типа: точка, линия или область, которое обязательно согласовано с координатным описанием основного объекта. Помимо координатного описания объект-атрибут обязательно имеет атрибутивное описание в виде одного значения своего атрибута. С точки зрения внутренней структуры хранения информации объект «Атрибут» размещается «дочерним» к основному объекту и автоматически удаляется при удалении основного объекта.

Для удобства работы с объектами-атрибутами значение их классификационного кода целесообразно формировать по определённому правилу, например, первым символом кода может быть латинская буква «А», а в младших разрядах указывать номер атрибута: A0000032 – код координированного атрибута номер 32.

При выделении объекта-атрибута информация о нём отображается в информационной строке основного меню головного модуля, как представлено на рисунке:

<p align="center">
<img src="_images/infostroka_atr.png">
</p>
<p align="center">
Отображение информации о линейном координированном атрибуте №&nbsp;46
</p>

В приведённом примере:
+ Номер атрибута – #46
+ Характер локализации – линия (2)
+ Акроним и название – widRoaWay/Ширина проезжей части

Объекты типа «Координированный атрибут» могут создаваться только в цифровых картах объектной модели. Если у объекта присутствует координированный атрибут, например, №&nbsp;32, то значение этого атрибута в некоординированном виде, т.е. целиком для объекта, запрещено и наоборот – наличие значения атрибута у объекта целиком исключает возможность создания для него координированного атрибута с этим номером.

Противоречащие друг другу значения одного атрибута не могут пересекаться своими координатными описаниями (например, в одном и том же месте автодороги не может быть асфальтовое и щебёночное покрытие, в одной и той же точке болото не может быть проходимым и непроходимым).

#### Объект «Подпись»

Объект вида «Подпись» – также именуемый как «Текстовый объект», является специальным картографическим объектом, предназначенным для отображения на фиксированном месте в карте содержимого атрибутов пространственных объектов, например, собственного наименования. Однако, объект может создаваться в карте для размещения какой-либо подписи, не связанной с пространственными объектами.

Подпись имеет векторное описание, состоящее из одной точки или набора точек ломаной линии (как контур линейных объектов). Для хранения содержимого подписи в объекте всегда используется только один атрибут (характеристика) с номером 9 строкового типа.

На карте объект типа «Подпись» отображается строкой, у которой содержание соответствует набору символов, тип шрифта (величина, наклон) – выбранному коду текстового объекта, а направление и привязка – векторному представлению (текст на карте размещается вдоль заданной линии).

Если объект-подпись отображает значение атрибута какого-либо пространственного объекта, то целесообразно его хранить «дочерним» к этому пространственному объекту. Это облегчает процесс автоматического обновления подписей по информации из родительского объекта и исключает ошибочную ассоциацию подписи с другими объектами карты.

#### Объект «Информация»

Информационный объект не имеет пространственного положения, т.е. для него нельзя создать координатное описание. Он создаётся для того, чтобы хранить дополнительное атрибутивное описание пространственного объекта, которое не целесообразно включать в состав основного. Для объекта в Классификаторе определяется основной набор атрибутов, которые необходимы большинству пользователей, но в то же время, для различных тематических (специальных) приложений объекту необходимо добавить различные наборы специальных характеристик, например, описать объект «Строение» характеристиками прочности конструкции. В этом случае основной набор атрибутов не расширяется, но создается специальный тематический информационный объект с набором дополнительных характеристик. Этот информационный объект связывается с основным объектом, но выдается по запросу специальных потребителей.

У пространственного объекта может быть несколько информационных объектов. Один информационный объект может быть связан с несколькими пространственными объектами.

{% note info %}

Создание информационных объектов возможно только в цифровой карте объектной модели.

{% endnote %}

Поскольку информационные объекты не имеют координатного описания и могут быть не связаны с пространственными объектами, то обращение к ним невозможно через окно редактора, где отображаются все пространственные объекты. Для работы с информационными объектами используется окно «Проводник» (вызов с помощью CTRL+F5). Пример работы с информационным объектом в проводнике представлен на рисунке:

<p align="center">
<img src="_images/infoobject.png">
</p>
<p align="center">
Окно «Проводник» с отображением информационных объектов
</p>

### Локальная и глобальная идентификация объекта

Объект цифровой карты при создании автоматически получает значение своего локального идентификатора, уникального в пределах карты.

**Локальный идентификатор ((locID или Локид))** – целое число (номер объекта), значение которого хранится в виде служебной характеристики с номером 1000. Номер объекта уникален только в пределах цифровой карты и в случае переноса объекта из одной карты в другую ему присваивается новое значение Локида.

Для обеспечения возможности глобальной, не зависящей от карты, идентификации объекта ему может быть присвоен глобальный уникальный идентификатор.

**Глобальный уникальный идентификатор (guID или Гуид)** – текстовая строка длиной 36 символов с уникальным случайным набором цифр и латинских букв. Присвоение объектам карты значения Гуидов выполняется при необходимости с помощью отдельной процедуры из библиотеки dll_dm2. При переносе объекта из карты в другую карту или в отдельную базу данных Гуид сохраняет свое значение и не теряет свойства уникальности. Хранится значение Гуида в служебной характеристике номер 999.

Удалить или изменить значение Локида и Гуида интерактивно невозможно.

### Атрибутивное описание

Описание свойств объектов выполняется в виде значений атрибутов пяти простых видов:
+ Текст
+ Целое число
+ Дробное число
+ Логический
+ Перечислимый

И одного сложного:
+ Составной или комплексный

Атрибуты описываются в программе Редактор бланков параметрами:
+ Номер атрибута (целое число) – обязательно
+ Тип атрибута (см. таблицу 3 для простых видов) – обязательно
+ Наименование атрибута (произвольная текстовая строка) – не обязательно
+ Акроним – не обязательно

Каждый класс объекта в Редакторе Классификатора ссылается на свой «бланк», расположенный в файле &#42;.bln Классификатора и являющийся описанием набора атрибутов, допустимых для данного класса объекта.

Если в составе атрибутов объекта есть составной атрибут, то он имеет тип «blank», т.е. ссылку (номер) на другой бланк этого файла, где описаны его атрибуты. Таким образом, один бланк вложен в другой и уровни вложенности не ограничены.

#### Простые атрибуты {#anchor6}

В таблице представлен перечень и описание атрибутов всех простых видов по их типам, которые пользователь может включить в состав атрибутов для описания свойств объектов.

| №<br>п\п | Тип<br>атрибута | Код<br>типа^*^ | Описание атрибута                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------|--------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1     | string       | 9         | Текст – строка символов (один байт на символ)                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 2     | text         | 17        | Текст – строка символов в кодировке Unicode (два байта на символ) и возможностью вставки в текст символов переноса строки.                                                                                                                                                                                                                                                                                                                                                  |
| 3     | latin1       | 23        | Текст – строка символов в кодировке расширенной латиницы latin1 (один байт на символ). Вариант атрибута типа text, но с 256 символами.                                                                                                                                                                                                                                                                                                                                      |
| 4     | rtf          | 24        | Текст – строка символов в RTF-формате. Значение атрибута заполняется внешними программами и только отображается, редактирование невозможно.                                                                                                                                                                                                                                                                                                                                 |
| 5     | time         | 4         | Длинное целое число значения времени в формате: чч:мм:сс (часы, минуты, секунды)                                                                                                                                                                                                                                                                                                                                                                                            |
| 6     | date         | 5         | Длинное целое число значения значение даты в формате: гггг.мм.чч (год, месяц, число)                                                                                                                                                                                                                                                                                                                                                                                          |
| 7     | byte         | 0         | Целое число длиной 1 байт в диапазоне [0…255]                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 8     | word         | 1         | Целое число длиной 2 байта в диапазоне [0..65535]                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 9     | int          | 2         | Целое число длиной 2 байта в диапазоне [-32000…32000]                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 10    | long         | 3         | Целое число длиной 4 байта в диапазоне [–2147483648…2147483647]                                                                                                                                                                                                                                                                                                                                                                                                          |
| 11    | number       | 20        | Числовое интервальное значение:<br>=&nbsp;&nbsp;&nbsp;– строгое равенство одному числу<br>>&nbsp;&nbsp;&nbsp;– больше указанного числа<br><&nbsp;&nbsp;&nbsp;– меньше указанного числа<br>>=&nbsp;&nbsp;&nbsp;– больше или равно указанному числу<br><=&nbsp;&nbsp;&nbsp;– меньше или равно указанному числу<br>(....)&nbsp;&nbsp;&nbsp;– интервал значений, указанные границы входят в значение<br>[....]&nbsp;&nbsp;&nbsp;– интервал значений, указанные границы не входят в значение<br>!=&nbsp;&nbsp;&nbsp;– любое значение, кроме указанного<br>Значение атрибута хранится в виде текстовой строки типа string |
| 12    | float        | 6         | Дробное число длиной 4 байта (8 значащих цифр)                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 13    | single       | 7         | Дробное число длиной 4 байта (8 значащих цифр)                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 14    | angle        | 8         | Дробное число длиной 8 байта (16 значащих цифр)                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 15    | double       | 14        | Дробное число длиной 8 байта (16 значащих цифр)                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 16    | logic        | 12        | Логическое значение – да/нет                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 17    | dbase        | 10        | 1. Перечислимый тип c возможностью выбора только одного значения из списка.<br>2. Связь со значением из таблицы внешней базы данных.                                                                                                                                                                                                                                                                                                                                           |
| 18    | list         | 16        | Перечислимый тип c возможностью выбора нескольких значений из простого списка.                                                                                                                                                                                                                                                                                                                                                                                              |
| 19    | enumw        | 21        | Перечислимый тип с возможностью выбора одного или нескольких значений из иерархического списка.                                                                                                                                                                                                                                                                                                                                                                             |
| 20    | enum         | 11        | Перечислимый тип с возможностью выбора одного значения из выпадающего списка, при этом список значений хранится непосредственно в бланке классификатора и редактирование списка доступно в редакторе бланков bln.exe. Особенностью данного типа является то, что список значений одной характеристики может быть разный для разных объектов. |
| 21    | unicode      | 15        | Хранение значений в кодировке unicode                                                                                                                                                                                                                                                                                                        |
| 22    | color        | 18        | Аналог int – целое число длиной 2 байта в диапазоне [-32000…32000], но редактирование как цвет объекта                                                                                                                                                                                                                                       |

^*^ Указанное в третьем столбце значение кода типа атрибута используется в условных логических выражениях анализа объектов карты.

#### Атрибуты перечислимого типа {#anchor4}

Атрибутами перечислимого типа описываются качественные свойства объекта, которые могут принимать значения только из заранее установленного (предопределенного) списка (материал покрытия, тип водотока и т.п.).

Список значений (словарь) атрибута представляется в виде таблиц из двух столбцов. Первый столбец – код строки списка, второй – значение свойства в виде текстовой строки. Например, таблица атрибута «Материал покрытия» представленная на рисунке:

<p align="center">
<img src="_images/atrlistinfo.png">
</p>
<p align="center">
Таблица атрибута перечислимого типа
</p>

Строки в таблице отсортированы по возрастанию значений кодов. Код строки не может принимать нулевое значение.

В файле карты для атрибутов перечислимого типа хранится не значение свойства, а его код из таблицы.

Атрибуты перечислимого типа могут иметь иерархическую структуру (тип enumw), когда верхнее в дереве иерархии значение атрибута является обобщающим для дочернего списка значений. Пример атрибута иерархического типа «тип автодороги» приведён на следующем рисунке:

<p align="center">
<img src="_images/atrlistinfo_enumw.png">
</p>
<p align="center">
Иерархический атрибут перечислимого типа
</p>

Обобщающие значения атрибута используются в случае отсутствия детальной информации о значении атрибута, например, известно, что автодорога «обслуживаемая», но не известен точно её тип.

Значение атрибута перечислимого типа может принимать сразу несколько значений из списка (типы list и enumw), например:
+ мост может быть изготовлен из нескольких видов материала;
+ период действия горного перевала – несколько указанных месяцев из общего списка календарных месяцев в году;
+ здание может иметь несколько функциональных назначений.

Для некоторых атрибутов может быть установлено только одно значение (тип dbase или enumw), например:
+ класс автодороги не может быть одновременно автострадой и грунтовой дорогой;
+ происхождение объекта либо естественное, либо искусственное.

Если для атрибута возможно только одно значение (тип dbase), то оно хранится в карте в виде числового значения кода строки из таблицы.

Если для атрибута возможно несколько значений из списка, то они хранятся в карте в виде текстовой строки типа string, в которой через запятую перечисляются значения кодов из таблицы.

Для атрибутов перечислимого типа таблицы со списками возможных значений, из которых пользователь выбирает требуемые, содержатся в файле Классификатора с расширением &#42;.mdb, являющимся внутренней базой данных Классификатора, в которой хранятся значения всех атрибутов перечислимого типа. Вместо базы данных MDB-типа таблицы со списками возможных значений могут быть представлены dbf-файлами на каждый атрибут и размещены в папке с именем DBF, расположенной рядом с папкой классификатора OBJ.

#### Множественность и обязательность значений атрибутов

Свойство может быть присуще объекту целиком (например, собственное название) или иметь множественные значения, например:
+ ширина водотока не одинакова в различных его местах, что приводит к необходимости описывать местоположение этого свойства различными значениями на объекте (см. [«Координированный атрибут»](#anchor3));
+ здание может быть построено из нескольких видов материалов (см. атрибуты перечислимого типа list и enumw – [«Атрибуты перечислимого типа](#anchor4)).

Множественность значения атрибута описывается в поле «Множественность» в окне «Инспектор» Редактора бланков, как представлено на рисунке: {#anchor5}

<p align="center">
<img src="_images/blninfo.png">
</p>
<p align="center">
Установление множественности значения атрибута
</p>

Значение множественности одного и того же атрибута может устанавливаться для каждого класса объекта в виде допустимого минимального и максимального значений атрибута, например:
1. «0..*» – значения атрибута может не быть или может быть сколько угодно значений;
1. «0..1» – значения атрибута может не быть, но допускается только одно значение;
1. «1..*» – атрибут всегда должен иметь хотя бы одно значение;
1. «1» – атрибут всегда должен иметь только одно значение.

Если в описании множественности в качестве минимального значения указывается ноль – атрибут необязателен для данного класса объекта, в противном случае атрибут обязателен. Если поле «Множественность» не заполнено для атрибута, то это означает множественность – «0..*».

Если множественность значений атрибута больше единицы, то такой атрибут может быть координированным.

Обязательность атрибута для объекта, помимо множественности, описывается ещё в поле «Отсутствие», расположенном над полем «Множественность» ([рисунок «Установление множественности значения атрибута»](#anchor5)). Если поле отсутствие установлено в значение «Разрешено», значит объект может существовать без данного атрибута и нарушение множественности интерпретируется как ошибка Классификатора. Если же значение поля «Отсутствие» установлено в «Запрещено», то при создании объекта данного класса необходимо будет обязательно ввести значение данного атрибута. Если значение не будет введено, объект не будет записан в цифровую карту.

#### Ограничения на значения атрибутов или сочетания значений

При описании класса объекта в Классификаторе для значений некоторых атрибутов могут быть введены ограничения, обусловленные, как правило, здравым смыслом. Например, можно ограничить максимальное и минимальное значение атрибута «Абсолютная высота» рельефа поверхности суши (от -27&nbsp;м до 8848&nbsp;м), или атрибут перечислимого типа, используемый несколькими классами объектов, – для объекта данного класса может принимать не все значения, содержащиеся в таблице базы данных.

Для одного класса объекта могут быть установлены ограничения на сочетания значений его атрибутов, когда атрибуты не могут одновременно принимать противоречащие друг другу значения или какой-либо атрибут не имеет смысла при определённом значении другого атрибута. 

Например, автомобильная дорога описывается двумя атрибутами: материал покрытия и тип автодороги. Если тип автодороги – «просёлочная», то в этом случае атрибут «материал покрытия» (асфальт/щебень/бетон) не может принимать никакого значения.

Наличие одного атрибута или его определённое значение может влиять на обязательность другого атрибута, т.е. при условии наличия или определенного значения одного атрибута другой становится обязательным. Например, если для автомобильной дороги указан тип – «шоссе», то атрибут «материал покрытия» можно считать обязательным.

Описание ограничений выполняется в виде условного логического выражения в Редакторе бланков.

#### Составной/комплексный атрибут

Некоторые классы атрибутов целесообразно группировать с указанием для этой группы самостоятельного имени, например:
1. Для объекта «Паромная переправа» атрибуты, описывающие характеристики непосредственно парома (тип, грузоподъёмность, размеры) целесообразно объединить под одним атрибутом с именем «Паром».
2. Значение атрибута «Собственное название» может иметь два варианта написания – на русском и английском языке. Чтобы не вводить два различных класса атрибута, атрибут «Собственное название» можно описать отдельным типом данных, объединяющим два простых класса атрибута – «Текст написания названия» и «Язык написания названия». Сочетания их значений позволит иметь множество экземпляров одного собственного названия объекта на различных языках.

Составной/комплексный атрибут – атрибут, имеющий собственное имя (номер), значением которого является набор значений других атрибутов, как простых, так и составных.

Составной атрибут описывается самостоятельным типом – «blank».

На рисунке представлена схема организации атрибутивного описания объекта с простыми и комплексными атрибутами. Простые атрибуты обозначены An, комплексные – АКn, где n – номер атрибута.

<p align="center">
<img src="_images/scheme_complexatr.png">
</p>
<p align="center">
Схема атрибутивного описания объекта с использованием комплексных атрибутов
</p>

Объект, представленный на рисунке, имеет следующий состав атрибутов:

1. 11 атрибут (простой) = 1
1. 13 атрибут (простой) = 3
1. 12 атрибут (комплексный) в двух экземплярах:
+ 1 экземпляр имеет в своём составе:
    + 14 атрибут (простой) = 4
    + 15 атрибут (комплексный) в двух экземплярах:
        + 1 экземпляр имеет в своём составе:
            + 16 атрибут (простой) = 1
            + 17 атрибут (простой) = 1
        + 2 экземпляр имеет в своём составе:
            + 16 атрибут (простой) = 2
            + 17 атрибут (простой) = 2
    + 2 экземпляр имеет в своём составе:
        + 14 атрибут (простой) = 5
        + 15 атрибут (комплексный) в одном экземпляре в составе:
            + 16 атрибут (простой) = 1
            + 17 атрибут простой = 3

С точки зрения внутренней структуры хранения информации комплексный атрибут записывается в карту в виде **служебного дочернего** объекта к основному. Тип этого объекта «attribute» и он имеет своё атрибутивное описание. Этот служебный объект не может иметь координатного описания.

#### Использование атрибутов из таблиц внешних баз данных

Простой атрибут типа dbase связывается с таблицей из внутренней базы данных Классификатора с расширением &#42;.mdb в окне «Инспектор» Редактора бланков, как это представлено на рисунке. Имя таблицы в поле «Table» совпадает с номером атрибута в поле «Номер».

<p align="center">
<img src="_images/atr_dbase_bln.png">
</p>
<p align="center">
Связь номера атрибута с именем таблицы в файле Классификатора &#42;.mdb
</p>

В поле «Столбец» указывается номер столбца (поля) таблицы, значение из которого будет отображаться в бланке атрибутов объекта.
При указании номера столбца следует учитывать, что столбцы сортируются по алфавиту написания своих имён, т.е. столбец с именем, состоящим из латинской буквы «A», будет иметь номер 1.

В некоторых случаях значения атрибутов объекта удобнее вести в таблицах внешних баз данных. Например, независимо от цифровых карт ведутся реестры для населённых пунктов – таблицы с большим количеством описывающих их атрибутов (несколько вариантов названий, тип, статус, численность населения и т.п.). Этими реестрами пользуются различные информационные системы и вести их удобно в одной базе данных для всех пользователей.

ПК «ГИС Нева» предоставляет возможность «связать» свои атрибуты с полями внешних баз данных для отображения в цифровой карте информации об объектах. Эти базы данных должны быть типа MDB и размещаться в папке с именем DB, находящейся внутри рабочей папки. Редактирование значения полей в этом случае выполняется только во внешней базе данных с использованием программы MS Access.

Для связи с внешней базой данных используется **атрибут-связь** типа «dbase».

В окне «Инспектор» Редактора бланков описывается связь этого атрибута с определённым полем таблицы внешней mdb-базы данных. Пример такой связи представлен на рисунке:

<p align="center">
<img src="_images/atr_mdb_bln.png">
</p>
<p align="center">
Описание связи атрибута с внешней базой данных
</p>

Связь описывается тремя значениями полей:
+ Database – имя файла базы данных;
+ Table – имя таблицы в базе данных;
+ Столбец – номер поля (столбца) в таблице.

Правило указания номера столбца такое же, как при описании связи с внутренней таблицей Классификатора. В цифровой карте в качестве значения такого dbase-атрибута хранится код выбранной строки таблицы, хранящийся в столбце (поле) номер 1.

Описанный механизм связи предполагает, что атрибут может быть связан только с одной таблицей в одной базе данных, т.е. это механизм прямого указания имён базы данных и таблицы.

При необходимости использования значений одного атрибута из нескольких таблиц или баз данных описание их имён выполняется косвенным способом заполнением только поля «Database» в окне «Инспектор», как показано на следующем рисунке:

<p align="center">
<img src="_images/atr_mdb_bln2.png">
</p>
<p align="center">
Рисунок А – Описание связи атрибута с внешними базами данных косвенным способом
</p>

В окне «Инспектор» в поле «Database» заполняется строка следующего содержания – «:bas_nam:tab_nam:col_nam», где
+ bas_nam – имя поля таблицы номер 99, в котором указано имя внешней базы данных;
+ tab_nam – имя поля таблицы номер 99, в котором указано имя таблицы во внешней базе данных;
+ col_nam – имя поля таблицы номер 99, в котором указано имя столбца (колонки) таблицы, откуда необходимо отобразить значение атрибута.

При этом заполняются поля соответствующей таблицы файла &#42;.mdb Классификатора. На рисунке ниже изображен фрагмент таблицы с номером 99 (для примера связи атрибута с внешними базами данных косвенным способом):

<p align="center">
<img src="_images/table99.png">
</p>
<p align="center">
Рисунок Б – Заполнение полей таблицы внутренней базы данных Классификатора
</p>

В этом случае в цифровой карте в качестве значения атрибута записывается составной номер строки таблицы, например, для рис. А и рис. Б значение атрибута 99=643.25, т.е. отображается значение поля «label» строки с номером 25 из таблицы «FederalRoads» базы данных «RussianRoads».

### Координатное описание объектов

Координатное описание объектов цифровой карты может быть представлено в одной из двух форм (моделей):
+ Картографическое «спагетти»
+ Цепочно-узловая структура (ЦУС)

Для каждой модели картографический редактор имеет свой набор функций для создания и редактирования координатного описания.

В карте могут одновременно присутствовать объекты в различных моделях, но экземпляр одного объекта может иметь координатное описание только в одной из моделей.

#### Картографическое «спагетти»

Форма представления координатного описания пространственных объектов, где каждый объект цифровой карты имеет свое координатное описание одного из характеров локализации (точка, линия, область). Оно создаётся при создании объекта и удаляется из карты вместе с объектом.

Если пространственное положение объектов совмещено в пространстве (объекта «насыпь» и объекта «автодорога», административной границы и административной единицы и т.п.), то их координатное описание дублируется для каждого объекта и редактируется отдельно.

Объектная модель цифровой карты реализована для данной формы представления координатного описания.

Такая форма, в первую очередь, ориентирована на отображение объектов, когда их «личное» координатное описание «одевается» в условный знак. Топологическое согласование координатных описаний смежных объектов при этом обеспечивается специальными приёмами создания и редактирования метрики объектов, а также для этого необходимо использовать специальные процедуры автоматического контроля.

Для создания специальных цифровых моделей местности, ориентированных на автоматическое обеспечение полного топологического согласования координатного описания всех объектов карты используется модель «цепочно-узловая структура».

#### Цепочно-узловая структура

Форма представления координатного описания пространственных объектов путём формирования общего для всех объектов графа, образованного координатными дугами (рёбрами), примыкающими начальными и конечными точками к объектам-узлам. Такой граф не допускает пересечения и дублирования дуг и узлов, а также отсутствия узлов в начальных и конечных точках дуг.

Координатное описание объекта представляет собой набор ссылок на рёбра и узлы. При этом объекты независимо друг от друга могут ссылаться на одни и те же дуги и узлы, чем и обеспечивается полное топологическое согласование пространственного положения объектов, поскольку изменение метрики дуги или узла означает редактирование в этот момент координатного описания всех объектов, которые на неё ссылаются.

Координатное описание объектов может быть преобразовано из одной модели в другую и обратно. При этом корректная модель ЦУС из «спагетти» может быть получена только в том случае, если в модели «спагетти» было обеспечено полное топологическое согласование метрик всех объектов.

#### Z-координаты в метрике объекта

Каждой точке координатного описания может быть присвоено значение специального параметра – третьей координаты. В качестве третьей координаты могут использоваться значения: высоты, глубины и времени. Значения данных параметров присваиваются точкам координат при загрузке информации из внешних файлов или значение высоты и глубины может быть присвоено по информации открытых одновременно с картой растровых массивов матриц высот или глубин.

#### Основное и дополнительное координатное описание объекта

Пространственное положение объекта, как правило, описывается в цифровой карте в виде одного координатного описания (метрика объекта), выражающегося координатами главной точки, или осевой линии, или замкнутой линии, проходящей по внешней границе объекта. Это координатное описание является основным, однако, иногда, особенно при подготовке цифровой карты для мультимасштабной визуализации или использования в информационно-расчётных задачах, возникает необходимость сформировать для пространственного объекта дополнительные координатные описания. Например, для населённого пункта имеют смысл два координатных описания – точечное, расположенное в его центре и площадное по его границе, для водотока – линейное координатное описание по оси водотока и площадное по береговой линии.

ПК «ГИС Нева» обеспечивает возможность формирования для пространственного объекта одного основного координатного описания и неограниченного количества дополнительных, которые могут быть созданы в дополнение к основному. При этом характер локализации дополнительных координатных описаний может быть любым из разрешенных для данного класса объекта в Классификаторе.

Дополнительное координатное описание также доступно для редактирования, как и основное, выбор объекта для редактирования его атрибутов можно осуществить, указав основное или любое дополнительное координатное описание. С точки зрения внутренней структуры хранения информации дополнительное координатное описание записывается в виде **служебного дочернего** объекта к основному. Этот дочерний объект имеет координатное описание, но не может иметь своего атрибутивного описания.

Дополнительное координатное описание может быть создано только в объектной модели карты и модели координатного описания типа «спагетти».

#### Специальные типы координатного описания линий и областей

Для объектов типа «линия» и «область» возможно создание координатного описания специальных типов:
+ Эллипс
+ Кривая

Координатное описание типа «Эллипс» описывается координатами двух или трёх точек. Первая из них – центральная точка (пересечение малой и большой оси), вторая и третья – пересечение большой и малой осей с контуром эллипса. Как частный случай двумя точками описывается эллипс, выродившийся в окружность.

Координатное описание типа «Кривая» (Кривая Безье) описывается набором точек, обеспечивающих построение плавных кривых.

Специальные типы координатных описаний используются при векторизации объектов для обеспечения плавности (не «изломанности») полилиний. После векторизации они отдельной функцией редактора «line» могут быть преобразованы в классическую полилинию путём аппроксимации кривых с указанием порога аппроксимации. При выборе в карте объекта «эллипс» в информационной строке отображается значение характера локализации – 5, а при выборе объекта «кривая» в информационной строке отображается значение характера локализации – 6 (в случае линейного объекта) или 7 (в случае площадного объекта).

#### Специальный тип объекта – «массив глубин»

В электронных навигационных картах в соответствии со стандартом S-57 предусмотрен специальный тип точечного объекта – «массив глубин». Объект такого типа описывает плановое положение и значения глубин набора точечных объектов – «отметок глубин». Координатное описание этого точечного объекта состоит из набора точек. Каждая точка соответствует одной отметке глубины - координаты X,Y описывают плановое положение отметки глубины, а значение Z-координаты является значением глубины в этой точке.

Атрибуты такого объекта являются общими для всех точек массива. При выборе такого объекта в информационной строке отображается значение характера локализации – 11. Преобразование набора точечных объектов «отметка глубины» в один объект «массив глубин» и обратно выполняется с помощью процедур «Собрать массив знаков» и «Разобрать массив знаков» библиотеки dll_cn.

### Описание и установление отношений (связей) между объектами

#### Связи между объектами в картографической модели

Классификатор картографической модели не содержит описания отношений между классами объектов, однако структурная модель цифровой карты в виде иерархического дерева предполагает возможное установление связи между объектами карты типа «родитель»-«ребёнок», т.е. один объект может быть подчинён другому. При этом из-за специфики модели «дерева» для этой связи есть ограничение – объект может быть дочерним только к одному родителю и при этом никакой смысловой «окраски» для этой связи сохранить в карте нельзя. Смысловая трактовка связи содержится только в контексте классов родительского и дочернего объектов. Например, целесообразно объекты «Подпись» хранить в виде дочерних для основных объектов, значения чьих атрибутов подпись отображает. Картографические объекты-условные знаки (знак количества путей на железной дороге) также можно разместить как дочерние к самой железной дороге.

Установление связи «родитель»-«ребёнок» и её разрушение может быть выполнено с помощью специальных функций Редактора карты.

При удалении родительского объекта удаляются все его дочерние объекты.

#### Отношения и связи между объектами в объектной модели

Установление связей между объектами в цифровой карте объектной модели выполняется в соответствии с описанием в Классификаторе допустимых отношений между классами объектов.

По степени взаимной зависимости классов объектов в отношениях они подразделяются на типы:
1. **Агрегация** – отношения части и целого (один объект является «контейнером/родителем» для другого, второй – «содержимое контейнера/ребёнок»).
Например, мост, как дорожное сооружение, является частью дороги (агрегата) и исполнение дорогой своих функций зависит от поведения (качества) моста. При этом мост как пространственный объект может существовать и вне дороги.
1. **Композиция** – сильная агрегация, когда зависимый объект не может существовать без основного объекта-родителя. 
Примеры: водопад является частью водотока и не может быть без водотока, просека является элементом леса и не существует без леса.
1. **Ассоциация** – простая связь, описывающая любые другие виды зависимости, в том числе и равноправные отношения объектов.
 
Например, реки и проходящие над ними мосты не подчинены друг другу, однако в своей ассоциации они влияют на судоходность водного транспортного пути по реке, устанавливая ограничение на высоту проходящих судов под мостами.

В общем случае в модели данных описание отношения выполняется указанием:
+ двух участвующих в нём классов (исходного и целевого);
+ наименованием роли, которую играет целевой класс для исходного класса;
+ множественности участия объектов целевого класса в данной роли для одного экземпляра объекта исходного класса.

Множественность исходного класса всегда равна единице, а множественность целевого класса, как правило, больше единицы. В агрегациях и композициях родительский класс является исходным, дочерний – целевым, т.е. в одном агрегате может быть много частей. В простой ассоциации, например, водотоков с мостами, через один водоток может проходить много мостов, т.е. водоток – исходный класс, а мост – целевой.

Описание отношения (связи) в ПК «ГИС Нева» выполняется в Редакторе Классификатора для объекта **исходного класса** путём указания класса целевого объекта с последующим описанием связи в специальном окне «Связь», изображённом на рисунке:

<p align="center">
<img src="_images/agregaciya_obj.png">
</p>
<p align="center">
Описание отношения (связи) между классами объектов
</p>

На данном рисунке приведён пример описания отношения для класса «Автодорога» – исходный класс. Мостовое сооружение – целевой класс. Описание состоит из следующих полей (см. поля в окне сверху вниз):
+ Наименование и акроним отношения (разделены символом «/»);
+ Тип связи - «агрегация»;
+ Множественность объектов целевого класса [0…0], что означает необязательность связи и неограниченность количества целевых объектов для одного исходного (мостов может не быть на автодороге, или может быть сколько угодно);
+ Ограничения:
    + Семантика – условное логическое выражение для проверки допустимости связи в зависимости от значений атрибутов объектов целевого и исходного класса (например, пешеходный мост не может быть связан с автодорогой типа «шоссе»);
    + Топология – условие для проверки корректности топологии координатных описаний объектов исходного и целевого классов (все точки метрики моста должны быть совмещены с точками метрики дороги).

С точки зрения внутренней структуры хранения информации связь между двумя объектами записывается в карту в виде служебного дочернего объекта типа «связь» к основному объекту. Причём служебный объект «связь» записывается в двух экземплярах – объекту исходного класса (исходная связь) и объекту целевого класса (целевая связь). В виде атрибутов объект «связь» содержит информацию:
+ Ссылку на ответный объект связи:<br>&nbsp;&nbsp;&nbsp;&nbsp;1001 атрибут (long) = Локид ответного объекта;
+ Код типа связи:<br>&nbsp;&nbsp;&nbsp;&nbsp;1003 атрибут (byte): 1 – ассоциация, 2 – агрегация, 3 – композиция;
+ Признак исходной/целевой связи:<br>&nbsp;&nbsp;&nbsp;&nbsp;1002 атрибут (byte): 1 – исходная связь (объект исходный в этой связи), 2 – целевая связь (объект целевой в этой связи);
+ Акроним и имя связи: 9 атрибут (string).

Для сохранения целостности информации о связях при переносе объектов из одной карты в другую, когда изменяются значения локальных идентификаторов, в связь отдельной процедурой должен быть записан атрибут guID (номер 999) ответного объекта.

#### Координатное описание связи между объектами

Объект исходного класса «без метрики» создаётся путём установления его связей с другими объектами целевого класса, т.е. его пространственное положение описывается координатным описанием связанных с ним объектов целевого класса. В этом случае, как правило, объекты целевого класса участвуют в связи с объектом исходного класса целиком. Однако, например, если в качестве пространственного объекта формировать объект класса «Автомобильный путь в сети дорог», у которой один атрибут – значение номера дороги, то такой объект будет «без метрики» и в него по связям будут входить все автодороги и их участки, по которым эта «номерная» дорога проходит. Если какая-то автодорога не входит в номерную дорогу целиком, то можно указать ту её часть координатного описания, которая участвует в связи с «номерной» дорогой. В этом случае связь дороги «без метрики» с целевой дорогой будет сохранять координаты участвующего в связи участка.

Таким образом, связь получает свое координатное описание. С точки зрения внутренней структуры хранения информации для служебного объекта «связь» формируется метрика, как дубль фрагмента метрики объекта целевого класса. Если объект участвует в связи целиком, то метрика связи не формируется.

Реализация такой возможности формирования метрики для связи позволяет сохранять целостность объектов и не выполнять их деление для участия своими частями в связях с другими объектами.

### Кодовые обозначения видов и типов объектов

При работе с объектами цифровой карты во всех информационных строках, меню и окнах отображается их классификационный код и числовой код вида или типа объекта. Перечень числовых кодов видов и типов объектов представлен в таблице:

| Значение<br>кода<br>вида/типа<br>объекта |   Вид/тип объекта                                                  |
|------------------------------------------|--------------------------------------------------------------------|
| 0                                        | Объект «Меню»                                                      |
| 1                                        | Пространственный объект типа «Знак»                                |
| 2                                        | Пространственный объект типа «Линия»                               |
| 3                                        | Пространственный объект типа «Область»                             |
| 4                                        | Объект «Подпись»                                                   |
| 5                                        | «Линия» или «Область» с координатным описанием типа «Эллипс»       |
| 6                                        | «Линия» с координатным описанием типа «Кривая»                     |
| 7                                        | «Область» с координатным описанием типа «Кривая»                   |
| 10                                       | Информационный объект                                              |
| 11                                       | Точечный объект «массив глубин»                                    |
| 21                                       | Пространственный объект типа «Знак» в цепочно-узловой структуре    |
| 22                                       | Пространственный объект типа «Линия» в цепочно-узловой структуре   |
| 23                                       | Пространственный объект типа «Область» в цепочно-узловой структуре |
| 30                                       | Объект «комплексный атрибут» (datatype)                            |
| 31                                       | Объект «координированный атрибут» точечной локализации             |
| 32                                       | Объект «координированный атрибут» линейной локализации             |
| 33                                       | Объект «координированный атрибут» площадной локализации            |
| 40                                       | Объект «связь» без координатного описания                          |
| 41                                       | Объект «связь» точечной локализации                                |
| 42                                       | Объект «связь» линейной локализации                                |
| 50                                       | Пространственный объект «без метрики»                              |
| 101                                      | Дополнительное координатное описание – точка                       |
| 102                                      | Дополнительное координатное описание – линия                       |
| 103                                      | Дополнительное координатное описание – область                     |

## Привязка карты к местности

Координатное описание объектов карты во внутреннем файле DM-формата хранится в локальной прямоугольной целочисленной системе координат. Значения локальных координат в виде длинных целых чисел (пикселов) выбраны в целях обеспечения высокой скорости отображения информации карты в окне Редактора.

При создании цифровой карты обязательно устанавливается значение «Единицы хранения» земных координат в одном пикселе локальной системы координат, т.е. какое расстояние на местности соответствует одному пикселю карты. Значение единицы хранения устанавливается из списка возможных значений:
+ 1 метр
+ 1 дециметр
+ 1 сантиметр
+ 1 миллиметр

Значение единицы хранения может быть изменено для ранее созданных карт. При этом следует учитывать, что изменение в сторону увеличения значения (например, с 1&nbsp;дециметра на 1&nbsp;метр) приведёт к понижению точности координатного описания объектов.

Для обеспечения пересчёта координат из локальной системы в геодезическую, в карте всегда хранятся специальные точечные объекты – привязочные точки, располагаемые, как правило, по углам карты или участка местности, который она охватывает. Для номенклатурных листов топографических карт создаётся ещё одна точка в центре карты.

Точки привязки являются специальными точечными объектами с кодом 00000000 и размещаются автоматически при создании карты в её первом слое. Местоположение угловых точек определяет их координаты в локальной системе координат (метрика), а семантика содержит координаты этих точек в местной (геодезической) системе координат. Если цифровая карта типа «План», то прямоугольные координаты местности записаны в характеристиках 901 (X-координата) и 902 (Y- координата). Если цифровая карта типа Карта, то значение широты (B) хранится в 91-й характеристике, а значение долготы (L) в 92-й характеристике угловой точки. Удалить служебные объекты-угловые точки из карты невозможно. На рисунке приведено изображение одного из окон паспорта карты, где отображаются значения геодезических координат угловых точек карты и устанавливается единица хранения:

<p align="center">
<img src="_images/mestnost.png">
</p>
<p align="center">
Диалоговое окно «Местность» с установленными значениями<br>координат угловых точек и единицей хранения
</p>

Рамка карты является линейным объектом, проходящим через угловые привязочные точки. Данный объект хранится в виде метрики корневого объекта карты и отображается в виде замкнутой чёрной линии.

Для карт типа «План» рамка представляет собой четырёхугольник с углами, заданными при создании карты. Для номенклатурных листов карт рамка является трапецией. Углы четырёхугольника или трапеции совпадают с угловыми точками привязки. Рамка карты может содержать произвольное количество точек метрики. Например, для номенклатурных листов топографических карт масштаба 1:200&nbsp;000 и мельче программа автоматически добавляет необходимые точки прогиба в нижнюю и верхнюю стороны рамки.

## Проект карт и активная карта

Понятие «Проект» введено для организации одновременной работы со многими картами, растрами, ортофотопланами, а также для обеспечения возможности сохранения нескольких вариантов настройки программы и выбора любого из них в следующих сеансах работы.

Под проектом понимается список карт и растровых файлов, загруженных в программу для работы, а также набор параметров, которые определяют режимы работы. Проект может быть сохранён в виде специального файла с расширением &#42;.prj на диск, а затем загружен в программу. При загрузке проекта восстанавливается то состояние программы, в котором она находилась в момент сохранения этого проекта. Это позволяет организовать работу с разными картографическими проектами на одном рабочем месте (в том числе и для разных пользователей). После загрузки проекта его настройки переходят в текущий проект.

Проект определяет следующие характеристики программы:
+ совокупность карт, загруженных в картографический редактор;
+ набор растров и фотопланов, загруженных в картографический редактор;
+ характеристики отображения карт, входящих в проект (опции, пороги отображения и др.);
+ размеры и положение окна отображения карт (окна редактора);
+ цветовые настройки окна редактора (подложка и активный объект);
+ масштаб отображения и положение участка проекта, видимого в окне редактора.

В проекте также можно запомнить несколько фрагментов (настроек масштабов отображения и положения участков проекта, видимых в окне редактора), и затем восстанавливать изображение любого из этих фрагментов в окне редактора одной командой.

Перед выходом программа сохраняет текущий проект на диске в специальном файле (dmw.###), а при последующем запуске автоматически загружает этот проект и восстанавливает то состояние, в котором она находилась в последнем сеансе работы.

В проекте все карты, загруженные в программу, рассматривается как единая область, имеющая определённые габариты и общую систему координат. Область отображения программы ограничена габаритами проекта. В проекте можно настроить уровни отображения каждой карты, а также запретить редактирование отдельных карт.

Такие операции, как создание новых карт путём вырезания участков из существующих, восстановление графики, построение выборок и другие, могут выполняться одновременно для всех карт проекта при условии включения опции «Все карты» на странице «Главная» в диалоге «Опции».

При создании новой карты или открытии существующей эта карта автоматически добавляется в текущий проект. При закрытии карты она удаляется из текущего проекта. И, наоборот, при добавлении или удалении карты в текущем проекте она открывается или закрывается в программе.

В то же время только одна карта из проекта доступна в каждый конкретный момент времени для редактирования – Активная карта. Остальные карты проекта доступны только для отображения. Имя файла и путь к активной карте отображается в заголовке окна редактора, как представлено на рисунке:

<p align="center">
<img src="_images/patch_map.png">
</p>
<p align="center">
Имя и путь к активной карте в заголовке окна Редактора
</p>

В проекции и системе координат активной карты отображаются все карты проекта.

Если опция «Все карты» в окне опций установлена, то для того чтобы сделать любую карту активной достаточно щёлкнуть левой кнопкой мыши, когда курсор находится над этой картой. Если эта опция сброшена, то для смены изменения активной карты нужно при нажатой клавише Alt щёлкнуть левой или правой клавишей мыши, когда курсор находится в площади нужной карты. Если указано левой клавишей мыши – переключение происходит на карту вниз по списку карт проекта, правой – вверх по списку.

Признаком изменения активной карты является изменение в заголовке окна редактора имени активной карты.

Все операции по работе с проектом реализуются командами из меню «Проект», а также в окне «Проект», которое открывается командой функционального меню «Окна»–«Проект» или горячей клавишей F2.

## Правила описания условных логических выражений

Условные логические выражения используются в ПК «ГИС Нева» при выполнении следующих действий над объектами:
+ анализ свойств объектов карты для их отбора в выборку;
+ анализ значений атрибутов на отсутствие ограничений по значениям;
+ анализ значений атрибутов на отсутствие ограничений для установления связей;
+ анализ значений атрибутов для применения различных условных знаков при отображении объекта.

Логическое выражение используется для проверки условия, при выполнении которого производятся какие-то действия над объектом или наоборот – не производятся, поэтому оно получило название – условное.

Условное логическое выражение состоит из набора аргументов, объединяемых в выражение с помощью логических операций:

<span style="color:red">&</span> &nbsp;&nbsp;— И (логическое умножение)
<span style="color:red">!</span> &nbsp;&nbsp;&nbsp;&nbsp;— ИЛИ (логическое сложение)

Аргументы логического выражения, между которыми расположены символы логических операций («<span style="color:red">&</span>» или «<span style="color:red">!</span>») должны обязательно заключаться в круглые скобки:
(Аргумент_1)&(Аргумент_2)&((Аргумент_3)!(Аргумент_4))

В качестве аргументов используются логические утверждения, принимающие значения true (истина) или false (ложь). Каждое логическое утверждение представляет собой операцию сравнения вычисляемого значения какого-либо свойства объекта с числовой константой. Вычисляемые свойства описываются переменными или функциями, т.е. в левой части утверждения стоит переменная или функция, в правой – значение числовой константы, а между ними операция сравнения:

<span style="color:red">=</span> &nbsp;&nbsp;&nbsp;&nbsp;— равно
<span style="color:red"><></span> &nbsp;&nbsp;— не равно
<span style="color:red">></span> &nbsp;&nbsp;&nbsp;&nbsp;— больше
<span style="color:red"><</span> &nbsp;&nbsp;&nbsp;&nbsp;— меньше
<span style="color:red">>=</span> &nbsp;&nbsp;— больше или равно
<span style="color:red"><=</span> &nbsp;&nbsp;— меньше или равно

Вычисляемыми с помощью переменных и функций свойствами объекта являются: тип объекта, значение какого-либо атрибута, количество точек метрики, длина и т.п.

### Вычисляемые переменные и функции

Вычисляемые переменные и функции связаны с каким-либо свойством объекта, атрибута или связи.

Переменная обозначается символом латинского алфавита (заглавным или строчным), перед которым ставится знак «@», например, @u, @t и т.п.

Функция обозначается набором латинских символов и имеет аргумент, который указываются в скобках после обозначения функции, например, func(A) – функция с именем «func» и аргументом для её вычисления – A.

Мнемоника логического утверждения: @A>5, т.е. если вычисленное значение переменной A больше 5, то утверждение – true, в противном случае – false.

Далее представлено описание переменных и функций для свойств объектов, их атрибутов и связей.

#### Переменные для свойств объекта

| **Свойство объекта карты**                               | **Переменная** |
|----------------------------------------------------------|:--------------:|
| Код типа объекта (характер локализации) – см. [«Простые атрибуты»](#anchor6) | O              |
| Значение порога отображения                              | V              |
| Код цвета в соответствии с палитрой                      | I              |
| Уровень положения в иерархическом дереве                 | U              |
| Количество дочерних объектов                             | C              |
| Длина метрики объекта (в метрах местности)               | L              |
| Количество точек метрики объекта                         | N              |
| Площадь замкнутого контура объекта (в кв.м местности)    | S              |
| Наличие z-координат в метрике объекта                    | Z=1            |
| Отсутствие z-координат в метрике объекта                 | Z=0            |
| Установлен запрет на редактирование объекта              | F=0            |
| **Свойство текстового объекта (вид «Подпись»)** | **Переменная** |
| Текст размещен «над линией»                     | G=0 или Y=1    |
| Текст размещен «по линии»                       | G=1 или Y=2    |
| Текст размещен «под линией»                     | G=2 или Y=4    |
| Текст центрирован «плотный слева»               | H=0 или T=0    |
| Текст центрирован «разрядка по буквам»          | H=1 или T=1    |
| Текст центрирован «точка-буква»                 | H=2 или T=2    |
| Текст центрирован «вектор-буква»                | H=3 или T=3    |
| Текст центрирован «плотный справа»              | H=4 или T=4    |
| Текст центрирован «плотный по центру»           | H=5 или T=5    |
| Текст центрирован «разрядка по словам»          | H=6 или T=6    |
| Текст центрирован «выноска»                     | H=7 или T=7    |

Примеры логических утверждений для свойств объектов:

<span style="color:red">@u=3</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— уровень положения в иерархическом дереве равен 3;
<span style="color:red">@c>0</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— количество дочерних объектов больше нуля;
<span style="color:red">@o<>2</span> &nbsp;&nbsp;— характер локализации не равен 2;
<span style="color:red">@v<5</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— порог отображения меньше 5;
<span style="color:red">@s>500</span> &nbsp;&nbsp;— площадь объекта больше 500 м^2^.

#### Переменные и функции для свойств атрибутов

Основным свойством атрибутов является их значение. Для вычисления значений атрибутов вместо символа переменной указывается номер атрибута (характеристики) по Классификатору, например, @1 – для сравнения в логическом утверждении используется значение характеристики номер 1.

Пример логического утверждения:
<span style="color:red">@1>10</span> – значение числового атрибута номер 1 больше 10.

Для вычисления других свойств атрибутов используются функции, аргументом которых указывается номер атрибута. В приведенной ниже таблице в качестве аргумента функций указан символ «n», обозначающий номер атрибута.

| **Свойство атрибута**                                  | **Функция** |
|--------------------------------------------------------|:-----------:|
| Наличие атрибута с любым значением                     | nil(n)=0    |
| Отсутствие атрибута                                    | nil(n)=1    |
| Код типа атрибута (коды типов атрибутов см. Таблицу 3) | type(n)     |
| Атрибут со значением «unknown» - неизвестно            | unk(n)      |
| Комплексный (составной атрибут)                        | dt(n)       |
| Максимальное значение числового атрибута               | max(n)      |
| Минимальное значение числового атрибута                | min(n)      |
| **Свойство текстового атрибута** | **Функция** |
| Количество символов              | len(n)      |
| Все символы – цифры              | text(n)=1   |
| Все символы – строчные буквы     | text(n)=2   |
| Все символы – заглавные буквы    | text(n)=3   |
| Первый символ – цифра            | char(n)=1   |
| Первый символ – строчная буква   | char(n)=2   |
| Первый символ – заглавная буква  | char(n)=3   |

Примеры логических утверждений для свойств атрибутов:

<span style="color:red">nil(9)=0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— есть 9-я характеристика;
<span style="color:red">nil(9)=1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— отсутствует 9-я характеристика
<span style="color:red">text(100)=3</span>&nbsp;&nbsp;&nbsp;&nbsp;— все символы в 100-й характеристике – заглавные буквы
<span style="color:red">char(601)=1</span>&nbsp;&nbsp;&nbsp;&nbsp;— первый символ в 601-й характеристике цифра
<span style="color:red">char(601)=2</span>&nbsp;&nbsp;&nbsp;&nbsp;— первый символ в 601-й характеристике строчная буква
<span style="color:red">type(7)=9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— тип 7-й характеристики «string»
<span style="color:red">type(12)<>3</span>&nbsp;&nbsp;&nbsp;— тип 12-й характеристики не «long»
<span style="color:red">len(9)<4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— количество символов в строке 9 характеристики меньше 4
<span style="color:red">dt(301)=3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— количество составных атрибутов с номером 301 равно 3
<span style="color:red">@1>80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— значение 1-й характеристики больше 80
<span style="color:red">@4=127.5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;— значение 4-й характеристики равно 127.5

#### Контекстный анализ содержимого текстовых атрибутов

Для текстовых атрибутов логическое утверждение проверяется операцией сравнения «=» – равно, т.е. значение строки текстового атрибута сравнивается с текстовой константой, которая всегда указывается в кавычках, например:

@9="<span style="color:red">Москва</span>" – значение атрибута номер 9 совпадает с текстовой строкой «Москва».

В текстовой константе допускается использовать специальные символы «&#42;» и «?», обеспечивающие контекстное сравнение содержимого атрибута с константой:

@9="<span style="color:red">&#42;ква</span>" – обозначает, что результат сравнения будет true, если три последние символа атрибута 9 равны «ква». Наличие любых символов перед тремя последними не имеет значения;

@9="<span style="color:red">Мос&#42;</span>"– обозначает, что результат сравнения будет true, если первые три символа какого-либо слова строки атрибута 9 равны «Мос». Наличие любых символов после трёх первых не имеет значения;

@9="<span style="color:red">&#42;оск&#42;</span>"– обозначает, что результат сравнения будет true, если внутри атрибута 9 есть три рядом стоящих символа «оск». Наличие любых символов до и после этих трёх не имеет значения;

@9="<span style="color:red">Мо&#42;ва</span>" – обозначает, что результат сравнения будет true, если первые два символа атрибута 9 равны «Мо», а последние два символа атрибута равны «ва». Наличие любых символов между начальными и конечными не имеет значения.

Если имеет значение количество не сравниваемых символов, которые обозначаются символом «&#42;», то вместо «&#42;» используется символы «?», расположение каждого из которых обозначает только один не сравниваемый символ, например:

@9="<span style="color:red">Мос???</span>"– обозначает, что результат сравнения будет true, если первые три символа атрибута 9 равны «Мос», а после них в строке атрибута расположено только три любых символа.

Если кавычки указаны без команды, например, @9="", то в этом случае будет производиться поиск 9-й характеристики, значение которой состоит только из пробелов.

Если необходимо провести контекстный анализ содержимого текстового атрибута на наличие в нём символа кавычек, то в этом случае в качестве внешних кавычек строки константы необходимо использовать одинарные кавычки, а внутри указать символ двойных кавычек, например:

@9='<span style="color:red">&#42;"&#42;</span>' – поиск кавычки в любом месте текстового атрибута номер 9.

В текстовой константе также могут быть использованы служебные символы, управляющие режимом контекстного анализа строки:

"<span style="color:red">^</span>" – указывает на поиск символов только с начала строки;
"<span style="color:red">^#</span>" – обозначает, что в этом месте строки должна быть любая цифра, 
"<span style="color:red">^$</span>" – обозначает, что в этом месте строки должна быть любая буква.

Примеры логических утверждений с использованием служебных символов:

<span style="color:red">@9="^Мос&#42;"</span> – поиск символов в начале строки, если указать без ^, то будут отбираться так же строки, где «Мос» встречается в начале слов находящихся внутри строки.
<span style="color:red">@9="&#42;к^#"</span> – в 9-й характеристике после буквы "к" должна стоять цифра.
<span style="color:red">@9="&#94;$&#94;#&#42;"</span> – в значении 9-й характеристики есть рядом стоящие буква и цифра (например, М1).
<span style="color:red">@9="^$ &#42;"</span> – значение 9-й характеристики начинается с отдельно стоящей буквы.
<span style="color:red">@9="&#42; ^$ &#42;"</span> – в значении 9-й характеристики есть одна отдельно стоящая буква в середине строки.

#### Логические утверждения для атрибутов перечислимого типа и атрибутов-связей с внешней базой данных

Особенностью атрибутов перечислимого типа является то, что для них в цифровой карте в качестве значения хранится не строковое значение, например, «асфальт», а числовой код строки таблицы базы данных, т.е. анализ значения атрибута перечислимого типа возможен в двух вариантах – для кодового значения строки и для текстового значения атрибута, хранящегося в таблице.

Например, если необходимо для атрибута типа «dbase» с номером 10, проверить значение кода, то логическое утверждение выглядит следующим образом:

<span style="color:red">@10=1</span> – 10 атрибут имеет значение равное 1.

А если необходимо проверить не значение кода, а текстовое значение строки, соответствующей этому коду, то логическое утверждение в этом случае выглядит следующим образом (добавляется символ «@» после номера атрибута):

<span style="color:red">@10@=«асфальт»</span> – 10 атрибут имеет значение равное «асфальт».

В соответствии с установленной множественностью в Классификаторе для атрибутов перечислимого типа возможно как единственное значение, так допустима и множественность значений.

При составлении логического утверждения с анализом значений следует учитывать, что утверждения обычного типа на сравнение значений с константой можно использовать только для случаев, когда атрибут имеет ТОЛЬКО одно значение из списка (тип dbase), например:

<span style="color:red">@262=3</span> – 262 атрибут имеет только одно значение равное 3.

<span style="color:red">(@262=3)!(@262=5)</span> – 262 атрибут имеет только одно значение – 3 или 5.

Выражение типа <span style="color:red">(@262=3)&(@262=5)</span> всегда равно false, т.к. при допустимом одном значении оно не может быть равно 3 и 5 одновременно.

Для атрибутов перечислимого типа, допускающих множественные значения (типы list, enumw), необходимо использовать специальные мнемоники логического утверждения для следующих вариантов условий:

_1) Проверка наличия среди установленных указанных значений._

&nbsp;&nbsp;<span style="color:red">"3"->@262</span> – значения «3» входит в список установленных значений 262 характеристики.
&nbsp;&nbsp;<span style="color:red">"3,5"->@262</span> – значения «3» и «5» входят в список установленных значений 262 характеристики.

_2) Проверка отсутствия указанных значений среди установленных._
	
&nbsp;&nbsp;<span style="color:red">"3,5"->@262=0</span> – значения «3» и «5» отсутствуют в списке установленных значений 262 характеристики.

_3) Проверка, что установлены только указанные значения._
	
&nbsp;&nbsp;<span style="color:red">@262->"3,5"</span> – 262-я характеристика содержит только значение «3» И «5» в списке значений.
&nbsp;&nbsp;<span style="color:red">@262->"3,5"=0</span> – 262-я характеристика содержит другие значения кроме «3» И «5» в списке значений.

#### Логические утверждения для комплексных атрибутов

Обычное логическое утверждение для проверки значения атрибута оперирует номером атрибута, причём этот атрибут может быть только простого типа, для которого в карте существуют значения. Некоторые простые атрибуты находятся внутри комплексных и их использование в логических утверждениях выполняется специальным образом.

Особенностями комплексных атрибутов являются их следующие свойства:
1. Комплексные атрибуты не имеют собственных значений, т.е. их нельзя анализировать.
1. Имеют иерархическую внутреннюю структуру.

Таким образом, логическое утверждение для проверки значения какого-либо простого атрибута, входящего в состав комплексного, должно содержать описание «пути» в иерархическом дереве по всем вложенным комплексным атрибутам к конкретному значению простого атрибута для его анализа.

Этот путь до интересующего простого атрибута описывается в виде логического выражения, содержащего аргументы, указывающие номер комплексного атрибута и условие ветвления на каждом множественном значении атрибута. Общий вид логического выражения:

##(Агрумент_1)&(Аргумент_2)&….& (Аргумент_N)##

Структура написания «Аргумента»: <span style="color:red">(?N «пробел» (Условие))</span>, где
<span style="color:red">?N</span> – признак позиционирования на комплексный атрибут с номером N;
<span style="color:red">«Условие»</span> – логическое выражение, являющееся условием выбора экземпляра комплексного атрибута N для ветвления. Это условие анализирует значения простых атрибутов, входящих в состав комплексных, среди которых проводится выбор.

«Условие» может быть оформлено в двух вариантах:

Пример **первого варианта** – логическое выражение проверки значения атрибутов: (@12=3)&(@24=2), т.е. выбрать тот экземпляр комплексного атрибута, в котором атрибут 12 равен 3 и при этом атрибут 24 равен 2.

**Второй вариант** – вместо логического выражения проверки значений простых атрибутов ставится единица, что означает без проверки значений атрибутов выбрать первый попавшийся экземпляр комплексного атрибута. Как правило, указание единицы в условии выбора используется в случае, когда заведомо известно, что комплексный атрибут представлен в одном экземпляре.

На рисунке представлена схема объекта с простыми атрибутами (обозначены An) и комплексными атрибутами (обозначены АКn).

В схеме выделены два простых атрибута: А17=2 и А16=1, входящие в состав комплексных атрибутов АК15 во 2 и в 3 экземпляры соответственно.

<p align="center">
<img src="_images/scheme_complexatr2.png">
</p>
<p align="center">
Схема объекта с простыми и комплексными атрибутами
</p>

Логическое выражение для пути **к атрибуту А17=2** состоит из следующих аргументов:

(?12 @14=4) – выбрать из двух АК12 экземпляр, в котором А14=4
(?15 @17=2) – выбрать из двух АК15 экземпляр, в котором А17=2

Общий вид логического выражения для проверки значения 17 атрибута:

(?12 @14=4)&(?15 @17=2)

Логическое выражение для пути к **атрибуту А16=1** состоит из следующих аргументов:

(?12 @14=5) – выбрать из двух АК12 экземпляр, в котором А14=5
(?15 1) – выбрать первый попавшийся экземпляр АК15

Общий вид логического выражения для проверки значения 16 атрибута может иметь вид:

(?12 @14=5)&(?15 1)&(@16=1) или 
(?12 @14=5)&(?15 @16=1)

Использование в логическом выражении конструкции «? N» (знак вопроса с номером атрибута) означает позиционирование на комплексном атрибуте, т.е. «шаг вниз» в иерархическом дереве атрибутов. После выполнения этого шага вниз может выполняться анализ только тех атрибутов, которые расположены на этом уровне иерархии. Если в одно логическое выражение необходимо включить анализ содержимого нескольких комплексных атрибутов, расположенных на одном уровне, то после описания условия для одного комплексного атрибута необходимо выполнить перемещение на самый верхний уровень иерархии («вынырнуть») и заново позиционироваться на другой атрибут. Конструкция для перемещения на верхний уровень иерархии имеет вид <span style="color:red">(?0 1)</span>.

На рисунке ниже представлена схема объекта с двумя комплексными атрибутами (4 и 5). Логическое выражение условия проверки двух простых атрибутов (18 и 15), расположенных внутри разных комплексных выглядит следующим образом:

(?4 @18=1)&(?0 1)& (?5 @15=5)

<p align="center">
<img src="_images/scheme_complexatr3.png">
</p>
<p align="center">
Схема объекта с двумя комплексными атрибутами
</p>

#### Функции для свойств связей между объектами

Cвязи обладают свойствами:
+ тип связи (ассоциация, агрегация, композиция);
+ тип роли (исходный, целевой);
+ акроним связи (роли).

Функции для анализа свойств связей приведены в таблице, где
role_type — тип связи – целое число;
role_name — акроним связи (роли) – текстовая строка.

| Свойство связи                                                                                                      | Функция          |
|---------------------------------------------------------------------------------------------------------------------|:----------------:|
| Количество у объекта целевых связей (акроним и тип связи не имеют значения)                                         | <span style="color:red">dst</span>              |
| Количество у объекта исходных связей (акроним и тип связи не имеют значения)                                        | <span style="color:red">src</span>              |
| Количество связей указанного типа (ассоциация-1/агрегация-2/композиция-3), когда объект  в качестве целевого класса | <span style="color:red">dst(role_type)</span>   |
| Количество связей определённого типа в качестве исходного класса                                                    | <span style="color:red">src(role_type)</span>   |
| Количество связей с определённым акронимом роли целевого класса                                                     | <span style="color:red">dst("role_name")</span> |
| Количество связей с определённым акронимом роли в качестве исходного класса                                         | <span style="color:red">src("role_name")</span> |

Примеры логических утверждений для свойств связей:

<span style="color:red">dst(2)=2</span> – у объекта две связи типа «агрегация» в качестве целевого класса;
<span style="color:red">src("Link")>0</span> – у объекта есть хотя бы одна связь с акронимом «Link» в качестве исходного класса;
<span style="color:red">dst("")=0</span>	– у объекта нет никаких связей в качестве целевого класса.

## Описание метаданных

При работе с информацией цифровой карты обеспечивается возможность формирования метаданных, т.е. данных, описывающих общие свойства и характеристики цифровой карты (например, системы координат, проекции, масштаба, актуальности информации, используемого классификатора и исходных материалов, по которым создана карта и т.п.), а также её составных элементов (объектов, атрибутов, координатных описаний). В зависимости от уровня описываемой информации метаданные подразделяются на уровни по старшинству:
+ Метаданные цифровой карты
+ Метаданные объекта
+ Метаданные атрибута
+ Метаданные координатного описания

Метаданные описываются значениями атрибутов (характеристик). Часть атрибутов уровня цифровой карты, входящих в понятие «Паспорт карты», используется программой по умолчанию и не требует предварительных настроек. Заполнение значениями выполняется или автоматически при создании карты или вручную через окно «Паспорт карты». Описание необходимых пользователю дополнительных уровней и атрибутов метаданных выполняется в Редакторе Классификатора или в составе текущего Классификатора карты в виде специальным образом оформленных бланков для атрибутов метаданных различных уровней.

Один и тот же атрибут может использоваться для описания метаданных на различном уровне, например, актуальность информации может быть описана как для всей карты, так и для отдельного объекта. При этом указанная актуальность для объекта «перебивает» установленную актуальность для карты. Т.е. атрибуты метаданных младшего уровня «сильнее» этих же атрибутов, установленных на старшем уровне. 
Заполнение бланка метаданных для объекта или координатного описания (метрики) выполняется через меню, выпадающее по щелчку правой клавиши мыши для активного объекта или объекта-координатного описания как представлено на рисунке:

<p align="center">
<img src="_images/metadata_menu.png">
</p>
<p align="center">
Меню вызова бланков для заполнения метаданных<br>объекта и координатного описания
</p>

Вызов бланка метаданных для атрибутов выполняется в режиме редактирования атрибутов (семантики) непосредственно в бланке атрибутов объекта, как показано на рисунке:

<p align="center">
<img src="_images/metadata_bln.png">
</p>
<p align="center">
Меню вызова бланка заполнения метаданных для конкретного атрибута объекта
</p>

Хранение метаданных в цифровой карте осуществляется в виде специальных комплексных атрибутов с номерами:
+ #32000 – метаданные объекта;
+ #32001 – метаданные координатного описания;
+ #33NNN – метаданные атрибута с номером NNN.

## Служебные характеристики

Служебные характеристики имеют зарезервированные номера, обрабатываются головным модулем ПК «ГИС Нева» специальным образом и не требуют описания в Классификаторе.

Использование номеров служебных характеристик в пользовательских классификаторах для объектов карты нецелесообразно, так как может привести к непредсказуемым последствиям.

Для служебных характеристик зарезервирован диапазон номеров от 900 до 1023. К служебным характеристикам не относятся характеристики метаданных паспорта карты (номенклатура, имя карты, масштаб и т.п.). Номера паспортных характеристик могут использоваться в пользовательских классификаторах.

Часть служебных характеристик используется при организации хранения информации цифровых карт объектной модели во внешней объектно-ориентированной базе данных пространственных объектов (БДПО).

В представленной ниже таблице содержится список и описание служебных характеристик. Для типов данных характеристик используются следующие обозначения:

К – комплексный (составной) тип (в графе типа данных в скобках указаны номера внутренних атрибутов)
Т– текстовая строка
Ц – длинное целое число
Ч – дробное число
Б – байт

| Номер | Акроним | Наименование                                          | Тип<br>данных | Описание применения                                                                                                                                                                                                                        |
|:-----:|:-------:|-------------------------------------------------------|:-------------:|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 994   | extID   | Значения  глобальных идентификаторов других объектов | Т             | Содержит значение глобального идентификатора (GUID) другого объекта. Атрибут является реализацией специальной связи между объектами. Используется для предъявления другого объекта в центре экрана по указанному в атрибуте значению GUID. |
| 995   |  —      | Признак выгруженного объекта из базы данных           | Б             | Всем объектам, выгружаемым из БДПО, головной модуль присваивает автоматически значение характеристики =1. Атрибут используется для загрузки объектов обратно в базу данных.                                                                |
| 996   | guIDs   | История глобальных идентификаторов объектов          | К (999)       | Комплексный атрибут, объединяющий значения глобальных идентификаторов объекта, накапливаемые при операциях сшивки и деления объекта.                                                                                                       |
| 998   | mapID   | Идентификатор карты                                   | Т             | Глобальный уникальный идентификатор, присваиваемый цифровой карте.                                                                                                                                                                         |
| 999   | guID    | Глобальный уникальный идентификатор объекта           | Т             | Обязательно присваивается объекту карты перед выгрузкой в БДПО или другие цифровые карты. Присваивается объектам-связям, комплексным и координированным атрибутам.                                                                         |
| 1000  | —       | Внутренний локальный идентификатор объекта            | Ц             | Является уникальным значением в пределах карты. Присваивается всем объектам карты при их создании. Не присваивается специальным объектам (внутренние контуры, связи, координированные и комплексные атрибуты).                            |
| 1000  | locID   | Внешний локальный идентификатор объекта               | К (1000,&nbsp;998)  | Комплексный атрибут, объединяющий непосредственно значения локальных идентификаторов объектов и идентификаторов соответствующих им карт.                                                                                                   |
| 1001  | valID   | Значение локального идентификатора                    | Ц             | Значение локального идентификатора во внешнем локальном идентификаторе и в объекте-связи для ответного объекта.                                                                                                                            |
| 1002  |  —      | Признак исходного/ целевого объекта в связи           | Б             | В объекте связи указывает признак исходного/целевого объекта. Принимает значения: 1 – данный объект исходный в связи, 2 – данный объект целевой в связи.                                                                                   |
| 1003  |  —      | Тип связи                                             | Б             | В объекте-связи указывает тип связи. Принимает значения: 1- ассоциация, 2 – агрегация, 3 – композиция.                                                                                                                                     |

